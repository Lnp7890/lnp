<html lang="pl">

<body>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interaktywna Historia ‚Äî Sezon 1 & 2</title>
  <style>
    :root {
      --bg1: #071025;
      --card: #071827;
      --text: #e6eef6;
      --muted: #a8b3c4;
      --accent: #ef4444;
      --btn: #0f1724;
      --glass: rgba(255, 255, 255, 0.02);
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: Inter, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg1), #04101d);
    }

    .wrap {
      max-width: 1100px;
      margin: 24px auto;
      padding: 20px;
    }

    h1 {
      color: var(--text);
      text-align: center;
      margin: 6px 0 18px;
      font-size: 28px;
    }

    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 14px;
    }

    button.primary {
      background: linear-gradient(180deg, #0f1724, #112131);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.04);
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
    }

    button.primary:hover {
      transform: translateY(-3px)
    }

    .section {
      background: var(--card);
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 8px 30px rgba(2, 6, 23, 0.6);
      border: 1px solid var(--glass);
      margin-bottom: 16px;
    }

    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .season-btn {
      background: #0b1220;
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.03);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
    }

    .season-btn:hover {
      background: #0f1b2a
    }

    .chapter-btn {
      background: #071427;
      color: var(--text);
      border-radius: 8px;
      padding: 7px 10px;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.02);
    }

    .chapter-btn:hover {
      background: #0b2133
    }

    #chapterContent {
      background: linear-gradient(180deg, #071827, #061222);
      color: var(--text);
      padding: 18px;
      border-radius: 10px;
      white-space: pre-wrap;
      line-height: 1.55;
      max-height: 60vh;
      overflow: auto;
      border: 1px solid rgba(255, 255, 255, 0.03);
    }

    .note {
      color: var(--muted);
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
    }

    /* slot */
    #slotMachine {
      display: none;
      text-align: center;
      margin-top: 14px;
    }

    #slots {
      font-size: 48px;
      margin: 8px 0;
    }

    .red7 {
      color: var(--accent);
      font-weight: 800;
      text-shadow: 0 2px 12px rgba(239, 68, 68, 0.15);
    }

    .small {
      padding: 8px 10px;
      border-radius: 8px;
      background: #0b1220;
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.03);
      cursor: pointer;
    }

    .small:hover {
      background: #0f1b2a
    }

    #slotMsg {
      color: var(--muted);
      margin-top: 8px;
    }

    /* back */
    #backBtn {
      display: none;
      margin: 18px auto 0;
      display: block;
      background: #172033;
      color: #fff;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      cursor: pointer;
    }

    /* responsive */
    @media (max-width:720px) {
      .wrap {
        padding: 12px
      }

      h1 {
        font-size: 22px
      }

      #slots {
        font-size: 40px
      }
    }
  </style>
  </h>

  <body>
    <div class="wrap">

      <h1>"Zle zako≈Ñczenie" - Sezon 1 &amp; 2 - Aut. Piotr Baran</h1>

      <div class="section">
        <div class="controls" id="mainMenu">
          <button class="primary" id="badEndingBtn">Z≈Çe zako≈Ñczenie</button>
          <button class="primary" id="slotBtn">Jednorƒôki bandyta</button>
        </div>

        <div id="seasonArea" class="row" style="display:none;"></div>
        <div id="chapterArea" class="row" style="display:none; margin-top:12px;"></div>
      </div>

      <div id="chapterContent" style="display:none;"></div>

      <div id="slotMachine" class="section" style="display:none;">
        <div id="slots">üé∞ üé∞ üé∞</div>
        <div class="row" style="justify-content:center;">
          <button class="small" id="drawBtn">Losuj</button>
          <button class="small" id="clearBtn">Wyczy≈õƒá</button>
        </div>
        <div id="slotMsg" class="note"></div>
        <div class="note" style="margin-top:6px">Szanse: üçã 30% ‚Ä¢ üçä 25% ‚Ä¢ üçá 20% ‚Ä¢ üçí 15% ‚Ä¢ üí∞ 6% ‚Ä¢ üõéÔ∏è 3% ‚Ä¢ 7 (czerwona) 1%</div>
      </div>

      <button id="backBtn">Powr√≥t do menu g≈Ç√≥wnego</button>

      <div class="note">Wybierz ‚ÄûZ≈Çe zako≈Ñczenie‚Äù, potem sezon i rozdzia≈Ç. Jednorƒôki bandyta to oddzielna funkcja.</div>
    </div>

    <script>
      // ---- Dane (pe≈Çne teksty, bez zmian) ----
      // Sezon 1 (12 rozdzia≈Ç√≥w) - tre≈õci dok≈Çadnie pobrane z Twoich wiadomo≈õci:
      const season1 = {
        title: "Sezon 1",
        chapters: {
          1: {
            title: "Krople deszczu",
            text: `Lnp sta≈Ç na ciemnym chodniku, gdy nagle zaczƒÖ≈Ç padaƒá deszcz. Nie przejƒÖ≈Ç siƒô tym ani trochƒô ‚Äî zawsze lubi≈Ç, gdy krople sp≈Çywa≈Çy mu po w≈Çosach. M≈ºawka kropi≈Ça delikatnie, rytmicznie, a≈º w ko≈Ñcu przemieni≈Ça siƒô w ulewƒô.
W oddali dostrzeg≈Ç b≈ÇƒÖkajƒÖcego siƒô czarnego kota, kt√≥ry przemknƒÖ≈Ç miƒôdzy roz≈õwietlonymi, migoczƒÖcymi w deszczu latarniami. Chwilƒô p√≥≈∫niej jego uwagƒô przyciƒÖgnƒô≈Ça hu≈õtawka. Usiad≈Ç na niej i zaczƒÖ≈Ç siƒô bujaƒá coraz wy≈ºej, a≈º mia≈Ç wra≈ºenie, ≈ºe niemal siƒôga czubk√≥w drzew.
Kiedy wraca≈Ç do domu po zmroku, przeszed≈Ç przez puste boisko i ciche osiedle blok√≥w. Wreszcie po≈Ço≈ºy≈Ç siƒô do ≈Ç√≥≈ºka, a zasypiajƒÖc pomy≈õla≈Ç tylko: tak w≈Ça≈õnie minƒÖ≈Ç ten dzie≈Ñ.`
          },
          2: {
            title: "≈öwiat nie jest piƒôkny",
            text: `Obudzi≈Ç siƒô o poranku, gdy za oknem ƒáwierka≈Çy ptaki. Wspomina≈Ç jeszcze wczorajsze krople m≈ºawki ‚Äî jak piƒôknie wtedy wyglƒÖda≈Ç ≈õwiat. Po kr√≥tkich ƒáwiczeniach przysz≈Ça pora szko≈Çy. Po powt√≥rzeniu materia≈Çu usiad≈Ç do sprawdzianu, a p√≥≈∫niej, wychodzƒÖc z klasy, zauwa≈ºy≈Ç na schodach swojego znajomego, Iwo. Ten siedzia≈Ç znudzony i zapatrzony w przestrze≈Ñ.
Podszed≈Ç do niego i zaczƒôli rozmawiaƒá, ale nagle rozleg≈Ç siƒô dzwonek tak g≈Ço≈õny, ≈ºe a≈º bola≈Çy uszy. Nadszed≈Ç czas lekcji jƒôzyka polskiego. Trzeba by≈Ço napisaƒá wiersz. Bohater jednak nie potrafi≈Ç ‚Äî kartka pozosta≈Ça pusta, a w ko≈Ñcu podar≈Ç jƒÖ z frustracjƒÖ.
‚Äî Nie umiem ‚Äî wyszepta≈Ç.
Wtedy przypomnia≈Ç sobie m≈ºawkƒô. ZaczƒÖ≈Ç pisaƒá o niej, i nagle s≈Çowa pop≈Çynƒô≈Çy same. Wiersz, kt√≥ry powsta≈Ç, by≈Ç najpiƒôkniejszy, jaki kiedykolwiek widzia≈Ç. Jednak nauczyciel oceni≈Ç go na ‚Äûczw√≥rkƒô‚Äù ‚Äî przeciƒôtnie. Od tej chwili tamten dzie≈Ñ straci≈Ç sw√≥j blask i ju≈º nigdy nie wydawa≈Ç siƒô tak samo piƒôkny.`
          },
          3: {
            title: "Sny m√≥wiƒÖ prawdƒô",
            text: `Wraca≈Ç do domu, gdy z ga≈Çƒôzi spad≈Ça na niego kropla wczorajszej m≈ºawki. Od razu przypomnia≈Ç sobie tamten wiecz√≥r ‚Äî tak piƒôkny, tak pe≈Çen ciszy i ≈õwiat≈Ça.
Wkr√≥tce dotar≈Ç do domu, lecz nagle zadzwoni≈Ç telefon. Cztery nieodebrane po≈ÇƒÖczenia. Na ekranie pojawi≈Ça siƒô wiadomo≈õƒá: ‚ÄûKiedy idziesz na orlik?‚Äù
Chwilƒô p√≥≈∫niej by≈Ç ju≈º na boisku. Gra≈Ç, ≈õmia≈Ç siƒô i bawi≈Ç znakomicie. WracajƒÖc do domu, zn√≥w pomy≈õla≈Ç: ‚ÄûTo by≈Ç piƒôkny wiecz√≥r‚Ä¶ prawie tak piƒôkny, jak tamta m≈ºawka.‚Äù My≈õl ta powraca≈Ça wciƒÖ≈º i wciƒÖ≈º, a≈º wreszcie zasnƒÖ≈Ç.
Spa≈Ç g≈Çƒôboko, a≈º do czwartej nad ranem. Wtedy przy≈õni≈Ço mu siƒô co≈õ niezwyk≈Çego. W ≈õnie pojawi≈Ço siƒô jasne ≈õwiat≈Ço, kt√≥re wyszepta≈Ço:
‚ÄûTo sƒÖ najpiƒôkniejsze chwile twojego ≈ºycia.‚Äù`
          },
          4: {
            title: "Bez sens",
            text: `Kiedy siƒô obudzi≈Ç, przypomnia≈Ç sobie sen o ≈õwietle. Choƒá jego g≈Ços wciƒÖ≈º brzmia≈Ç w g≈Çowie, postanowi≈Ç go zignorowaƒá.
W szkole od razu poczu≈Ç, ≈ºe co≈õ siƒô zmieni≈Ço. Nic nie by≈Ço ju≈º takie samo. Nikt nie chcia≈Ç z nim rozmawiaƒá, a Iwo w og√≥le siƒô nie pojawi≈Ç. Przygnƒôbiony, zaszy≈Ç siƒô w ulubionym miejscu ‚Äî sali zwanej chill outem. Kiedy≈õ kocha≈Ç tƒô przestrze≈Ñ, teraz jednak wydawa≈Ça mu siƒô zupe≈Çnie inna. Szara, pusta, jakby kto≈õ odebra≈Ç jej barwy i tchnƒÖ≈Ç w niƒÖ co≈õ z≈Çego.
Po kilku bezbarwnych lekcjach wyszed≈Ç ze szko≈Çy. ≈öwiat wok√≥≈Ç wyglƒÖda≈Ç obco. Barwy zniknƒô≈Çy, a to, co dawniej tƒôtni≈Ço ≈ºyciem, teraz zdawa≈Ço siƒô milczeƒá. Wszystko zamknƒô≈Ço siƒô w ciszy bez ≈õwiat≈Ça i kolor√≥w.`
          },
          5: {
            title: "Mieszanka emocji",
            text: `Obudzi≈Ç siƒô z b√≥lem gard≈Ça i miƒô≈õni. Czu≈Ç siƒô os≈Çabiony, jakby cia≈Ço pr√≥bowa≈Ço wys≈Çaƒá mu jaki≈õ sygna≈Ç. Nie poszed≈Ç wiƒôc do szko≈Çy, lecz spƒôdza≈Ç czas bez celu, nudzƒÖc siƒô i snujƒÖc my≈õlami.
Dopiero oko≈Ço czternastej przypomnia≈Ç sobie, ≈ºe za dwie godziny przyjedzie jego nowy piesek.
‚Äî A no tak! Dzisiaj sobota! ‚Äî krzyknƒÖ≈Ç i roze≈õmia≈Ç siƒô szczerze.
Rado≈õƒá jednak trwa≈Ça kr√≥tko, niespe≈Çna ƒáwierƒá dnia. Gdy nadesz≈Ça noc, gra≈Ç jeszcze z przyjaci√≥≈Çmi, lecz w pewnym momencie u≈õwiadomi≈Ç sobie co≈õ nieuchronnego: to by≈Ça ostatnia taka gra. Od jutra czeka≈Ça go nauka, obowiƒÖzki, codzienno≈õƒá.
Game over.`
          },
          6: {
            title: "Szalik",
            text: `Po dniu spƒôdzonym na nauce zasnƒÖ≈Ç wcze≈õnie. Nad ranem obudzi≈Ç go d≈∫wiƒôk domofonu ‚Äî przysz≈Ça paczka. Otworzy≈Ç jƒÖ i zobaczy≈Ç sw√≥j wymarzony prezent: szalik ukochanego klubu, Ruchu Chorz√≥w.
Z u≈õmiechem wybieg≈Ç przed dom i ruszy≈Ç w stronƒô szko≈Çy. Po drodze jednak zatrzyma≈Ç go Mateusz, znany w okolicy z handlu narkotykami. Rozmowa zaczƒô≈Ça siƒô niewinnie, od temat√≥w o regionie, lecz w powietrzu wisia≈Ço co≈õ niepokojƒÖcego.
Nagle pojawi≈Ç siƒô Iwo ‚Äî dawny znajomy Piotrka. Bez wahania sp≈Çawi≈Ç Mateusza, kt√≥ry zniknƒÖ≈Ç w cieniu blok√≥w. Piotrek poczu≈Ç ulgƒô, a razem z Iwem ruszyli dalej. Wkr√≥tce natrafili na grupƒô kibic√≥w Ruchu, kt√≥rzy z uznaniem spojrzeli na jego nowy szalik i pochwalili go.
Czas p≈ÇynƒÖ≈Ç szybko, a≈º w ko≈Ñcu zabrzmia≈Ç dzwonek na pierwszƒÖ lekcjƒô. Wtedy Piotrek po raz pierwszy poczu≈Ç w sobie ciƒô≈ºar przeczucia. Wiedzia≈Ç, ≈ºe przed nim nie bƒôdƒÖ ≈Çatwe lata.`
          },
          7: {
            title: "Gieksa",
            text: `Piotrek wraca≈Ç ze szko≈Çy razem z kolegƒÖ z klasy, Hubertem. Ulica by≈Ça niemal pusta, cicha i dziwnie odleg≈Ça od codziennego zgie≈Çku.
Nagle napotkali grupƒô kiboli GKS-u, zwanych Gieksiarzami. Ich spojrzenia od razu spoczƒô≈Çy na szaliku Ruchu Chorz√≥w, kt√≥ry wisia≈Ç na szyi Piotrka niczym znak rozpoznawczy. W powietrzu zawis≈Ço napiƒôcie, zaczƒô≈Çy siƒô krzyki, pretensje, a atmosfera gƒôstnia≈Ça z ka≈ºdƒÖ chwilƒÖ.
Ostatecznie Gieksiarze odeszli, ale Piotrek i Hubert szybko zorientowali siƒô, ≈ºe sƒÖ ≈õledzeni. Kroki za plecami brzmia≈Çy coraz g≈Ço≈õniej.
W tej pustej, opustosza≈Çej okolicy, w cieniu drzew, Piotrek poczu≈Ç, jak co≈õ w nim pƒôka. SiƒôgnƒÖ≈Ç do kieszeni. Ch≈Çodny metal w d≈Çoni sprawi≈Ç, ≈ºe serce przyspieszy≈Ço. W jednej chwili rzeczywisto≈õƒá zmieni≈Ça siƒô w koszmar ‚Äî krzyk, szarpanina, chaos. A potem‚Ä¶ cisza.
WstrzƒÖ≈õniƒôci i przera≈ºeni, Piotrek i Hubert ukryli to, co siƒô wydarzy≈Ço, w gƒôstwinie lasu. Obaj wiedzieli, ≈ºe od tej chwili nic nie bƒôdzie ju≈º takie samo. Od tej granicy nie by≈Ço powrotu.`
          },
          8: {
            title: "PoczƒÖtki",
            text: `Z rana wciƒÖ≈º czu≈Ç ciƒô≈ºar tego, co zrobi≈Ç. My≈õli o wydarzeniach sprzed kilku godzin nie dawa≈Çy mu spokoju, lecz zamiast szukaƒá odpowiedzi, postanowi≈Ç uciec jeszcze dalej.
Obok sklepu rowerowego spotka≈Ç Dominika ‚Äî lokalnego dilera, znanego z tego, ≈ºe zawsze mia≈Ç co≈õ ‚Äûna sprzeda≈º‚Äù. Piotrek wszed≈Ç w rozmowƒô i wkr√≥tce dokona≈Ç pierwszego zakupu. Chcia≈Ç zag≈Çuszyƒá sumienie, odsunƒÖƒá od siebie obrazy, kt√≥re powraca≈Çy za ka≈ºdym razem, gdy zamyka≈Ç oczy.
Pod wp≈Çywem nowych bod≈∫c√≥w poczu≈Ç siƒô dziwnie silny, jakby jego cia≈Ço i umys≈Ç by≈Çy w stanie znie≈õƒá wiƒôcej, ni≈º powinny. Poszed≈Ç wiƒôc na lekcje, jak gdyby nigdy nic. Nikt nie zauwa≈ºy≈Ç, co dzia≈Ço siƒô w ≈õrodku ‚Äî lekcje minƒô≈Çy jak w p√≥≈Ç≈õnie.
Po szkole wr√≥ci≈Ç do Dominika. Tym razem nie po to, by kupiƒá, lecz by zapytaƒá o co≈õ wiƒôcej.
‚Äî Masz dla mnie robotƒô? ‚Äî spyta≈Ç cicho, niemal szeptem.
Dominik u≈õmiechnƒÖ≈Ç siƒô krzywo. ‚Äî Oczywi≈õcie. Dostaniesz dwadzie≈õcia procent z tego, co sprzedasz.
Piotrek skinƒÖ≈Ç g≈ÇowƒÖ. Czu≈Ç, ≈ºe przekracza kolejnƒÖ granicƒô. Zadowolony z pierwszego zarobku, zaczƒÖ≈Ç ostro≈ºnie handlowaƒá. Ka≈ºda moneta w jego d≈Çoni wydawa≈Ça siƒô ciƒô≈ºsza ni≈º wszystkie, kt√≥re kiedykolwiek wcze≈õniej trzyma≈Ç.`
          },
          9: {
            title: "Interesy i nie tylko",
            text: `Interesy sz≈Çy coraz lepiej. Piotrek sprzedawa≈Ç wiƒôcej ni≈º kiedykolwiek ‚Äî najpierw Iwo, potem kolejnym znajomym ze szko≈Çy, a≈º w ko≈Ñcu klientela zaczƒô≈Ça sama do niego przychodziƒá. PieniƒÖdze ros≈Çy w kieszeni, a wraz z nimi poczucie, ≈ºe wreszcie ma kontrolƒô nad swoim ≈ºyciem.
Ale im wy≈ºej siƒô wspina≈Ç, tym wiƒôcej budzi≈Ç wrog√≥w.
Pewnego wieczoru, gdy sta≈Ç pod blokiem, drogƒô zagrodzi≈Ç mu Mateusz. Jego spojrzenie by≈Ço zimne, pe≈Çne gniewu.
‚Äî My≈õlisz, ≈ºe mo≈ºesz wej≈õƒá na m√≥j teren? ‚Äî warknƒÖ≈Ç. ‚Äî To ja tu rzƒÖdzƒô, nie ty.
Piotrek nie cofnƒÖ≈Ç siƒô ani o krok. W jego oczach nie by≈Ço ju≈º lƒôku, tylko determinacja. S≈Çowa zamieni≈Çy siƒô w przepychanki, a przepychanki w co≈õ, czego nie da≈Ço siƒô ju≈º zatrzymaƒá. W ciemno≈õci rozleg≈Ç siƒô st≈Çumiony krzyk, a Mateusz upad≈Ç na ziemiƒô. Cisza zapad≈Ça gwa≈Çtownie, gƒôsta jak dym.
Piotrek patrzy≈Ç na swoje dr≈ºƒÖce d≈Çonie i wiedzia≈Ç, ≈ºe w≈Ça≈õnie przekroczy≈Ç kolejnƒÖ granicƒô, kt√≥rej nie da siƒô cofnƒÖƒá.
Kiedy nastƒôpnego dnia spotka≈Ç siƒô z Dominikiem, atmosfera by≈Ça ciƒô≈ºka. Ten d≈Çugo patrzy≈Ç mu w oczy, jakby pr√≥bowa≈Ç zajrzeƒá do samego wnƒôtrza.
‚Äî Mateusz by≈Ç m√≥j ‚Äî powiedzia≈Ç powoli, zimnym tonem. ‚Äî Nie podoba mi siƒô to, co zrobi≈Çe≈õ.
Piotrek spu≈õci≈Ç wzrok. Serce wali≈Ço mu jak m≈Çot.
Nagle Dominik parsknƒÖ≈Ç kr√≥tkim, nieprzyjemnym ≈õmiechem. ‚Äî Ale wiesz co? Masz w sobie co≈õ, czego tamtemu brakowa≈Ço. Odwagƒô. Zaciƒôcie. A mo≈ºe po prostu szale≈Ñstwo. ‚Äî Zbli≈ºy≈Ç siƒô o krok. ‚Äî Wybaczam ci. Ale pamiƒôtaj‚Ä¶ drugi raz ci siƒô nie upiecze.
Piotrek skinƒÖ≈Ç g≈ÇowƒÖ. Czu≈Ç, ≈ºe w≈Ça≈õnie zosta≈Ç przyjƒôty g≈Çƒôbiej w krƒÖg, z kt√≥rego nie ma odwrotu.`
          },
          10: {
            title: "Tylko nie Kacper",
            text: `Piotrek nie by≈Ç ju≈º zwyk≈Çym sprzedawcƒÖ. Od tamtego momentu sta≈Ç siƒô wsp√≥lnikiem Dominika. Razem planowali interesy, dzielili zyski i decyzje. Piotrek czu≈Ç w sobie dziwne poczucie w≈Çadzy ‚Äî mieszaninƒô adrenaliny i odpowiedzialno≈õci, kt√≥rej nigdy wcze≈õniej nie zazna≈Ç.
Wkr√≥tce do ich krƒôgu do≈ÇƒÖczy≈Ç Kacper ‚Äî m≈Çody, pewny siebie ch≈Çopak, kt√≥rego Dominik poleci≈Ç jako solidnego ‚Äûpracownika‚Äù. Kacper szybko wpasowa≈Ç siƒô w zesp√≥≈Ç, uczƒÖc siƒô zasad, zyskujƒÖc zaufanie Piotrka i Dominika. Wszystko sz≈Ço sprawnie, a interes rozrasta≈Ç siƒô szybciej ni≈º ktokolwiek m√≥g≈Ç przypuszczaƒá.
Jednak pewnej nocy spok√≥j zosta≈Ç brutalnie przerwany. Kacper nie wr√≥ci≈Ç do domu, a nastƒôpnego dnia wiadomo≈õƒá o jego ≈õmierci dotar≈Ça do Piotrka i Dominika.
‚Äî Kto m√≥g≈Ç to zrobiƒá? ‚Äî spyta≈Ç Piotrek, nie mogƒÖc powstrzymaƒá dr≈ºenia w g≈Çosie.
Dominik milcza≈Ç. Jego spojrzenie by≈Ço twarde i nieprzeniknione.
‚Äî Nie wiadomo ‚Äî odpowiedzia≈Ç w ko≈Ñcu. ‚Äî Ale jedno jest pewne. Musimy byƒá ostro≈ºni. Kto≈õ z zewnƒÖtrz przesunƒÖ≈Ç pionek na planszy‚Ä¶ i to nie by≈Ça przypadkowa ofiara.
Piotrek poczu≈Ç lodowaty dreszcz. ≈öwiadomo≈õƒá, ≈ºe ich ≈õwiat staje siƒô coraz bardziej niebezpieczny, wpe≈Çz≈Ça mu pod sk√≥rƒô. Ka≈ºdy krok m√≥g≈Ç teraz decydowaƒá o ≈ºyciu albo ≈õmierci, a granica miƒôdzy zaufaniem a zdradƒÖ stawa≈Ça siƒô coraz cie≈Ñsza.
W ich ≈õwiecie nikt nie by≈Ç bezpieczny.`
          },
          11: {
            title: "Kim ja jestem",
            text: `Po ≈õmierci Kacpra Piotrek zaczƒÖ≈Ç odczuwaƒá coraz wiƒôkszy dystans wobec Dominika. Ich drogi w interesach wciƒÖ≈º siƒô przecina≈Çy, ale Piotrek coraz czƒô≈õciej czu≈Ç ograniczenia ma≈Çego lokalnego ‚Äûterenu‚Äù, kt√≥ry Dominik kontrolowa≈Ç. Coraz czƒô≈õciej my≈õla≈Ç o czym≈õ wiƒôkszym ‚Äî o ≈õwiecie, kt√≥ry wykracza≈Ç daleko poza ulice ich miasta.
Pewnego wieczoru Piotrek nawiƒÖza≈Ç kontakt z grupƒÖ, kt√≥ra zarzƒÖdza≈Ça rozprowadzaniem narkotyk√≥w w ca≈Çej Polsce. Byli to ludzie, kt√≥rych istnienie wcze≈õniej zna≈Ç tylko z opowie≈õci ‚Äî sieƒá by≈Ça rozleg≈Ça, skomplikowana i niebezpieczna, a jej w≈Çadza siƒôga≈Ça daleko poza granice jego rodzinnego miasta.
PoczƒÖtki by≈Çy trudne. Piotrek musia≈Ç udowodniƒá lojalno≈õƒá, spryt i zdolno≈õƒá do podejmowania ryzyka. Jego znajomo≈õƒá lokalnego rynku i do≈õwiadczenie z Dominikiem sta≈Çy siƒô jego przewagƒÖ. Sprzeda≈º ros≈Ça, a kontakty z nowymi partnerami rozszerza≈Çy siƒô z dnia na dzie≈Ñ.
Z czasem Piotrek awansowa≈Ç. Z ma≈Çego wsp√≥lnika sta≈Ç siƒô koordynatorem dystrybucji, a potem kierownikiem regionalnym. Nauczy≈Ç siƒô zarzƒÖdzaƒá lud≈∫mi, negocjowaƒá i przewidywaƒá ruchy konkurencji. Jego reputacja ros≈Ça ‚Äî w ≈õwiecie, w kt√≥rym ka≈ºdy krok m√≥g≈Ç decydowaƒá o ≈ºyciu lub ≈õmierci, Piotrek stawa≈Ç siƒô synonimem skuteczno≈õci i zimnej logiki.
Po kilku latach jego wp≈Çywy obejmowa≈Çy ca≈Çy kraj. Sieƒá, kt√≥ra kiedy≈õ wydawa≈Ça siƒô nieosiƒÖgalna, teraz by≈Ça w jego rƒôkach. Zyska≈Ç kontrolƒô nad przep≈Çywem narkotyk√≥w, nad lud≈∫mi i nad pieniƒôdzmi. Jego pozycja by≈Ça niekwestionowana.
W ko≈Ñcu Piotrek sta≈Ç siƒô g≈Ç√≥wnym mafiozƒÖ ca≈Çej sieci. Ka≈ºda decyzja, ka≈ºdy ruch w ≈õwiecie, kt√≥ry kiedy≈õ by≈Ç jedynie mglistym snem, teraz zale≈ºa≈Ç od niego. Ludzie s≈Çuchali jego s≈Ç√≥w, jego woli podporzƒÖdkowywano losy i fortuny.
Jednak w≈Çadza mia≈Ça swojƒÖ cenƒô. Ka≈ºdy sukces ni√≥s≈Ç ze sobƒÖ ciƒô≈ºar odpowiedzialno≈õci, strachu i nieustannej czujno≈õci. Piotrek wiedzia≈Ç, ≈ºe pozostanie na szczycie wymaga po≈õwiƒôce≈Ñ, a granica miƒôdzy przyjacielem a wrogiem sta≈Ça siƒô cie≈Ñsza ni≈º kiedykolwiek.
W ≈õwiecie pe≈Çnym przemocy`
          },
          12: {
            title: "Ostatnie krople deszczu",
            text: `Na szczycie by≈Ço cicho. Cicho i zimno.
Piotrek mia≈Ç teraz wszystko ‚Äî pieniƒÖdze, wp≈Çywy, ludzi gotowych wykonaƒá ka≈ºde jego polecenie. By≈Ç najwa≈ºniejszym graczem w grze, kt√≥ra nie mia≈Ça ju≈º dla niego tajemnic. Ka≈ºdy telefon, ka≈ºda paczka, ka≈ºda decyzja przechodzi≈Ça przez jego rƒôce. Wszyscy w Polsce znali jego imiƒô, choƒá wypowiadali je tylko szeptem.
Ale nocami wraca≈Çy obrazy. Twarze ludzi, kt√≥rych skrzywdzi≈Ç. Cienie dawnych znajomych, wspomnienia z czas√≥w, kiedy m≈ºawka by≈Ça tylko m≈ºawkƒÖ, a ≈õwiat wydawa≈Ç siƒô prosty i kolorowy. ≈öwiat≈Ço z tamtego snu sprzed lat ‚Äî to, kt√≥re m√≥wi≈Ço mu, ≈ºe to najpiƒôkniejsze chwile twojego ≈ºycia ‚Äî teraz by≈Ço dalekie, zgaszone, obce.
Coraz czƒô≈õciej zamyka≈Ç siƒô w swoim gabinecie, odcina≈Ç od wszystkich. Dominik zniknƒÖ≈Ç z jego ≈ºycia, Iwo gdzie≈õ siƒô rozp≈ÇynƒÖ≈Ç. Na stole le≈ºa≈Çy pieniƒÖdze i dokumenty, a on czu≈Ç tylko pustkƒô. Nie by≈Ço ju≈º wyzwa≈Ñ. Nie by≈Ço przyjaci√≥≈Ç. Nie by≈Ço nawet strachu.
Pewnego wieczoru usiad≈Ç w fotelu i spojrza≈Ç w ciemno≈õƒá. W d≈Çoniach obraca≈Ç zimny, ciƒô≈ºki przedmiot. W my≈õlach przelecia≈Ço ca≈Çe jego ≈ºycie ‚Äî ulice z dzieci≈Ñstwa, hu≈õtawka, m≈ºawka, czarny kot, szko≈Ça, Iwo. Wszystko to, co kiedy≈õ by≈Ço wa≈ºne, teraz wydawa≈Ço siƒô snem.
Przez chwilƒô wydawa≈Ço mu siƒô, ≈ºe s≈Çyszy ten sam g≈Ços ze snu: ‚ÄûTo sƒÖ najpiƒôkniejsze chwile twojego ≈ºycia.‚Äù
≈Åzy nap≈Çynƒô≈Çy mu do oczu. Zrozumia≈Ç, ≈ºe dotar≈Ç na szczyt tylko po to, by znale≈∫ƒá tam pustkƒô. strzeli≈Ç sobie rewolwerem w g≈Çowƒô...
Nastƒôpnego dnia znaleziono go w gabinecie. Na biurku le≈ºa≈Ça kartka:
‚ÄûNie zosta≈Ço mi nic pr√≥cz ciszy.‚Äù
≈öwiat, kt√≥ry zbudowa≈Ç, runƒÖ≈Ç w jednej chwili.`
          }
        }
      };
      // Sezon 2 (13 rozdzia≈Ç√≥w) - pe≈Çne tre≈õci:
      const season2 = {
        title: "Sezon 2",
        chapters: {
          1: {
            title: "Biuro to≈ºsamo≈õci",
            text: `Po ≈õmierci Piotrka nawet wiatr wydawa≈Ç siƒô inny ‚Äì ch≈Çodny, przeszywajƒÖcy, jakby ca≈Çy ≈õwiat zamar≈Ç. Nagle do jego biura wszed≈Ç Samuel, jego zaufany wsp√≥lnik z mafii. Zamar≈Ç na progu, patrzƒÖc na cia≈Ço szefa. Szok i niedowierzanie malowa≈Çy siƒô na jego twarzy.
Nie potrafi≈Ç uwierzyƒá, ≈ºe Piotrek naprawdƒô nie ≈ºyje. RozpoczƒÖ≈Ç desperackie dochodzenie w≈õr√≥d cz≈Çonk√≥w mafii, pytajƒÖc ka≈ºdego, kto m√≥g≈Çby co≈õ wiedzieƒá ‚Äì ale nikt nie mia≈Ç ≈ºadnej wskaz√≥wki.
Samuel wiedzia≈Ç, ≈ºe musi dzia≈Çaƒá szybko. Zawo≈Ça≈Ç Eryka, specjalistƒô od ‚Äûspraw sprzƒÖtajƒÖcych‚Äù. Eryk bez s≈Çowa wyjƒÖ≈Ç telefon i zadzwoni≈Ç po swojƒÖ ekipƒô ‚Äì sprawnie zajƒôli siƒô usuniƒôciem zw≈Çok. Policja, jak zwykle, nie dowiedzia≈Ça siƒô niczego; ≈õmierƒá Piotrka pozosta≈Ça tajemnicƒÖ, otoczona cieniem niepewno≈õci i strachu.`
          },
          2: {
            title: "Kuzyni",
            text: `Kuzyni Piotrka z Rosji, dowiadujƒÖ siƒô o jego ≈õmierci i prawdziwej to≈ºsamo≈õci. Szok szybko przeradza siƒô w gniew. Bez wahania przyje≈ºd≈ºajƒÖ do Polski, by odkryƒá, kto stoi za jego ko≈Ñcem.
≈öledztwo okazuje siƒô trudniejsze, ni≈º sƒÖdzili ‚Äî nikt nie wie nic pewnego, a zw≈Çoki Piotrka zniknƒô≈Çy jakby zapad≈Çy siƒô pod ziemiƒô. Gdy opuszczajƒÖ mroczny wie≈ºowiec, w kt√≥rym szukali odpowiedzi, zauwa≈ºajƒÖ Eryka i jego ekipƒô sprzƒÖtajƒÖcƒÖ. To oni byli ostatnimi, kt√≥rzy mieli kontakt z cia≈Çem Piotrka.
Starszy z kuzyn√≥w nie waha siƒô ani chwili. WyciƒÖga pistolet, a echo strza≈Çu roznosi siƒô po pustej okolicy. Eryk pada na ziemiƒô, a jego ludzie zastygajƒÖ w szoku. Drugi strza≈Ç prze≈Çamuje ciszƒô.
Kuzyni uciekajƒÖ w ciemno≈õƒá, a ekipa sprzƒÖtajƒÖca zostaje z nowym koszmarem na rƒôkach ‚Äî zamiast jednej ofiary, majƒÖ ju≈º dwie do znikniƒôcia.`
          },
          3: {
            title: "W≈Çam o pytanie",
            text: `Po tym, jak rosyjscy kuzyni Piotrka uciekli z miejsca strzelaniny, postanowili odwiedziƒá jeszcze jednƒÖ osobƒô ‚Äî jego brata, Tymona. Wiedzieli, ≈ºe ich kuzyn mia≈Ç z nim dawniej bliskie relacje, ale te≈º s≈Çyszeli plotki, ≈ºe co≈õ siƒô miƒôdzy nimi zepsu≈Ço.
Wspomnienia wr√≥ci≈Çy: dzie≈Ñ, w kt√≥rym Piotrek wr√≥ci≈Ç do domu roztrzƒôsiony po ≈õmierci Kacpra. Wtedy, w przyp≈Çywie szczero≈õci, wyzna≈Ç wszystko tylko Tymonowi. Ten jednak nie wytrzyma≈Ç ciƒô≈ºaru tych s≈Ç√≥w. Od tamtej pory odciƒÖ≈Ç siƒô od brata ca≈Çkowicie ‚Äî nigdy wiƒôcej z nim nie rozmawia≈Ç.
Kuzyni weszli do mieszkania Tymona i bez ogr√≥dek zapytali:
‚Äî Powiedz nam, co wiesz o ≈õmierci Piotrka.
Tymon spojrza≈Ç na nich zimno. Jego g≈Ços brzmia≈Ç twardo i odciƒôcie:
‚Äî Nic wam nie powiem. To nie wasza sprawa.
Ch≈Çodna cisza zawis≈Ça w powietrzu. Kuzyni wymienili spojrzenia, a w ich oczach pojawi≈Ç siƒô gniew. Gdy wychodzili, starszy z nich kopnƒÖ≈Ç w drzwi tak mocno, ≈ºe zatrzƒôs≈Çy siƒô futryny.
Na klatce schodowej rozbrzmiewa≈Ç tylko echo ich krok√≥w i niewypowiedziana obietnica zemsty.`
          },
          4: {
            title: "Nasze ostatnie ≈õwiƒôta",
            text: `W pewnym domu panowa≈Ça ≈õwiƒÖteczna atmosfera. Choinka migota≈Ça kolorowymi lampkami, w kominku trzaska≈Ç ogie≈Ñ, w tle gra≈Ça spokojna muzyka, a za oknem cicho sypa≈Ç ≈õnieg. Wszystko wyglƒÖda≈Ço jak poczt√≥wka z idealnych ≈öwiƒÖt‚Ä¶ dop√≥ki ciszƒô nie rozdar≈Ç huk t≈Çuczonego szk≈Ça.
Okna rozsypa≈Çy siƒô w drobny mak, a do ≈õrodka wdarli siƒô zamaskowani napastnicy. Rozleg≈Çy siƒô kr√≥tkie, brutalne strza≈Çy, echo odbi≈Ço siƒô od ≈õcian, a potem nastƒÖpi≈Ça cisza jeszcze bardziej przera≈ºajƒÖca ni≈º ha≈Ças sprzed chwili.
Zbrodniarze zniknƒôli tak szybko, jak siƒô pojawili, zostawiajƒÖc po sobie jedynie kartkƒô. Na niej, du≈ºymi literami, widnia≈Çy s≈Çowa: ‚ÄûRaz za raz‚Äù.
Kiedy przyjecha≈Ça policja, dom ju≈º pogrƒÖ≈ºony by≈Ç w milczeniu. Nie by≈Ço ≈ºadnych odcisk√≥w palc√≥w, ≈ºadnych ≈õlad√≥w. Jedynym dowodem by≈Ça kartka, kt√≥ra zdawa≈Ça siƒô obiecywaƒá, ≈ºe to dopiero poczƒÖtek.`
          },
          5: {
            title: "Krew",
            text: `Ignacy siedzia≈Ç w ciemnym samochodzie zaparkowanym niedaleko domu, w kt√≥rym jeszcze kilka minut wcze≈õniej rozbrzmiewa≈Ça ≈õwiƒÖteczna muzyka. Teraz panowa≈Ça tam cisza ‚Äì cisza, kt√≥rƒÖ sam stworzy≈Ç. Rodzina, kt√≥rƒÖ Piotrek kiedy≈õ oszczƒôdzi≈Ç, ju≈º nie ≈ºy≈Ça. Ignacy wiedzia≈Ç, ≈ºe Piotrek nigdy nie odwa≈ºy≈Çby siƒô pociƒÖgnƒÖƒá za spust. Ale Piotrek nie ≈ºy≈Ç. Kto≈õ musia≈Ç doko≈Ñczyƒá to, co jego kuzyn zostawi≈Ç niedoko≈Ñczone.
Zimny ≈õnieg topnia≈Ç na jego rƒôkawiczkach, gdy wraca≈Ç do miasta. W jego oczach nie by≈Ço ≈ºalu ‚Äì tylko determinacja.
Kilka dni p√≥≈∫niej Ignacy wszed≈Ç do biura, kt√≥re niegdy≈õ nale≈ºa≈Ço do Piotrka. Zrobi≈Ç to spokojnie, jakby by≈Ç u siebie. W ≈õrodku czeka≈Ç ju≈º Tymon, brat Piotrka, oraz W≈Çadzimierz ‚Äì dawny zastƒôpca.
‚Äî No i co teraz? ‚Äî Ignacy spojrza≈Ç prosto w oczy W≈Çadzimierza. ‚Äî Piotrek nie ≈ºyje. Ludzie zaczynajƒÖ gadaƒá. Kto przejmie schedƒô?
W≈Çadzimierz westchnƒÖ≈Ç ciƒô≈ºko i roz≈Ço≈ºy≈Ç rƒôce.
‚Äî Nie wiem, Ignacy‚Ä¶ Ale jedno jest pewne. Interes nie mo≈ºe siƒô zatrzymaƒá. Kto≈õ musi przejƒÖƒá jego miejsce.
Ignacy uni√≥s≈Ç brew, lekko siƒô u≈õmiechajƒÖc.
‚Äî Czyli ty?
‚Äî Tak. ‚Äî W≈Çadzimierz skinƒÖ≈Ç g≈ÇowƒÖ. ‚Äî Ja biorƒô to na siebie. Bƒôdziemy handlowaƒá dalej. Sieƒá nie mo≈ºe runƒÖƒá, bo inaczej wszyscy zginiemy.
Tymon, oparty o ≈õcianƒô, odezwa≈Ç siƒô cicho, ale stanowczo:
‚Äî Pamiƒôtajcie, Piotrek zap≈Çaci≈Ç najwy≈ºszƒÖ cenƒô. Nie pope≈Çniajcie tych samych b≈Çƒôd√≥w.
Ignacy spojrza≈Ç na niego, a w jego oczach b≈Çysnƒô≈Ço co≈õ, co trudno by≈Ço nazwaƒá ‚Äì gniew? A mo≈ºe ch≈Çodna obojƒôtno≈õƒá?
‚Äî B≈Çƒôdy sƒÖ po to, ≈ºeby je naprawiaƒá. A ja nie zamierzam powtarzaƒá s≈Çabo≈õci mojego kuzyna.
W biurze zapad≈Ça ciƒô≈ºka cisza. Trzech mƒô≈ºczyzn wiedzia≈Ço, ≈ºe od tego dnia wszystko siƒô zmieni.`
          },
          6: {
            title: "Wracamy do gry",
            text: `W magazynie panowa≈Ça cisza, tak gƒôsta, ≈ºe wydawa≈Ço siƒô, i≈º czas stanƒÖ≈Ç w miejscu. Powietrze by≈Ço letnie, ciƒô≈ºkie, pachnia≈Ço kurzem, drewnem i starym ≈ºelazem. Przez zakurzone okna wpada≈Çy promienie s≈Ço≈Ñca, kt√≥re przecina≈Çy mrok wƒÖskimi smugami. Ka≈ºdy kƒÖt magazynu zdawa≈Ç siƒô odciƒôty od ≈õwiata, jakby to miejsce by≈Ço zapomniane przez ludzi i przez Boga.
Nie by≈Ço s≈Çychaƒá nic poza cichym skrzypieniem blachy na dachu, gdy wiatr porusza≈Ç zardzewia≈Çe elementy. Cisza mia≈Ça w sobie co≈õ nienaturalnego ‚Äì zbyt spokojnego, jak na miejsce, kt√≥re kry≈Ço tyle tajemnic.

Nagle rozleg≈Ç siƒô d≈∫wiƒôk. Stukanie. Najpierw ciche, niemal nie≈õmia≈Çe, jakby kto≈õ puka≈Ç w drewno palcem. Potem coraz mocniejsze, stanowcze, desperackie. Echo uderze≈Ñ nios≈Ço siƒô po pustym wnƒôtrzu, rozbijajƒÖc ciszƒô na kawa≈Çki.
I wtedy‚Ä¶ zza jednej z przesuwnych ≈õcian da≈Ç siƒô s≈Çyszeƒá st≈Çumiony g≈Ços. Chrapliwy, zachrypniƒôty, ale znajomy.
‚Äî Halo‚Ä¶ jest tu kto?
To nie mog≈Ço byƒá prawdƒÖ. A jednak.
Za zardzewia≈ÇƒÖ blachƒÖ, ledwo ≈ºywy, ale ≈ºywy, siedzia≈Ç Piotrek. Ekipa sprzƒÖtajƒÖca, zamiast zako≈Ñczyƒá jego ≈ºycie, zabra≈Ça go w tajemnicy, ukrywajƒÖc przed ≈õwiatem i przed mafiƒÖ. Uratowali go, nie wiadomo z jakiego powodu ‚Äì czy za pieniƒÖdze, czy z lito≈õci, czy mo≈ºe kto≈õ mia≈Ç w≈Çasny plan.
Piotrek by≈Ç blady, wychudzony, z oczami, kt√≥re nosi≈Çy ≈õlad wszystkich jego demon√≥w. Powoli przeciska≈Ç siƒô przez szczelinƒô, a≈º wreszcie upad≈Ç na ch≈ÇodnƒÖ pod≈Çogƒô magazynu.
Oddycha≈Ç ciƒô≈ºko, a serce wali≈Ço mu jak m≈Çot.
Nie wiedzia≈Ç, gdzie jest, ani dlaczego wciƒÖ≈º ≈ºyje. Wiedzia≈Ç tylko jedno ‚Äî teraz jego ≈ºycie nie nale≈ºy ju≈º do niego. By≈Ç cieniem cz≈Çowieka, kt√≥ry kiedy≈õ rzƒÖdzi≈Ç ca≈Çym krajem. I musia≈Ç zdecydowaƒá: wr√≥ciƒá do gry‚Ä¶ czy zniknƒÖƒá raz na zawsze.`
          },
          7: {
            title: "Kariera",
            text: `Piotrek siedzia≈Ç chwilƒô w p√≥≈Çmroku magazynu, wciƒÖ≈º niepewny, czy naprawdƒô ≈ºyje. Ka≈ºdy oddech by≈Ç ciƒô≈ºki, a my≈õli rozbiega≈Çy siƒô jak dzikie zwierzƒôta. Nie wiedzia≈Ç, co zrobiƒá, ani dokƒÖd p√≥j≈õƒá.
Nagle us≈Çysza≈Ç kroki. W drzwiach stanƒÖ≈Ç Ignacy.
‚Äî Cze≈õƒá ‚Äî rzuci≈Ç kr√≥tko, jakby spotkali siƒô po zwyk≈Çym dniu.
Piotrek spojrza≈Ç na niego ostro, czujƒÖc dziwne napiƒôcie.
‚Äî A tamta rodzina? ‚Äî spyta≈Ç, choƒá ju≈º ba≈Ç siƒô odpowiedzi.
Ignacy nie mrugnƒÖ≈Ç okiem.
‚Äî SƒÖ sko≈Ñczeni.
Piotrek poczu≈Ç, jak ziemia usuwa mu siƒô spod n√≥g. Chcia≈Ç co≈õ powiedzieƒá, krzyknƒÖƒá, ale w gardle utkwi≈Ça mu cisza. W ko≈Ñcu tylko skinƒÖ≈Ç g≈ÇowƒÖ. Nie mia≈Ç ju≈º si≈Çy na sprzeciw.
Wyszli razem z magazynu. Ka≈ºdy krok wydawa≈Ç siƒô ciƒô≈ºszy od poprzedniego. Kiedy dotarli do wie≈ºowca, w kt√≥rym znajdowa≈Ço siƒô dawne biuro Piotrka, na schodach zatrzyma≈Ç ich Samuel.
‚Äî Szefie‚Ä¶ ty ≈ºyjesz? ‚Äî jego g≈Ços dr≈ºa≈Ç z niedowierzania.
Piotrek spojrza≈Ç mu w oczy.
‚Äî Tak ‚Äî odpowiedzia≈Ç cicho, ale stanowczo.
Razem weszli do sali zarzƒÖdu. W≈Çadzimierz, kt√≥ry zdƒÖ≈ºy≈Ç ju≈º rozsiƒÖ≈õƒá siƒô w fotelu lidera, zamar≈Ç na ich widok. Po chwili bez s≈Çowa wsta≈Ç. Piotrek usiad≈Ç z powrotem na swoim miejscu.
I tak ‚Äî historia zatoczy≈Ça krƒÖg. W≈Çadza wr√≥ci≈Ça do tego, kto mia≈Ç jƒÖ w rƒôkach od poczƒÖtku.`
          },
          8: {
            title: "Zazdro≈õci i nienawi≈õci",
            text: `Pewnego ranka Piotrek wyszed≈Ç przed drzwi swojego biura. Na korytarzu czeka≈Ç mƒô≈ºczyzna, kt√≥rego twarz zna≈Ç z dawnych czas√≥w ‚Äì Ksawery. By≈Ç starszy, zniszczony ≈ºyciem, ale w jego oczach wciƒÖ≈º tli≈Ç siƒô ogie≈Ñ do≈õwiadczenia. W ≈õwiecie interes√≥w Ksawery uchodzi≈Ç za starego wyjadacza, jednak to Piotrek w ostatnich latach wyprzedzi≈Ç go o kilka krok√≥w.
‚Äì Potrzebujƒô rady ‚Äì powiedzia≈Ç ch≈Çodnym g≈Çosem Ksawery, zbli≈ºajƒÖc siƒô. ‚Äì Wiem, ≈ºe masz wp≈Çywy, kt√≥rych ja ju≈º nie mam.
Piotrek spojrza≈Ç na niego obojƒôtnie. ‚Äì Nie mam nic do powiedzeniaw tej sprawie.
Na moment zapad≈Ça cisza. Ksawery skinƒÖ≈Ç g≈ÇowƒÖ, jakby chcia≈Ç zako≈Ñczyƒá rozmowƒô. ‚Äì W takim razie‚Ä¶ dziƒôkujƒô. Do widzenia.
Ale w nastƒôpnej sekundzie rzuci≈Ç siƒô gwa≈Çtownie na Piotrka, wyciƒÖgajƒÖc n√≥≈º. Zanim ostrze zdƒÖ≈ºy≈Ço b≈ÇysnƒÖƒá, Samuel wyskoczy≈Ç z korytarza, wykrƒôci≈Ç mu rƒôkƒô i wezwa≈Ç ochronƒô wie≈ºowca. Dw√≥ch ros≈Çych ochroniarzy obezw≈Çadni≈Ço Ksawerego i wyprowadzi≈Ço si≈ÇƒÖ na zewnƒÖtrz, zostawiajƒÖc Piotrka z uczuciem zimnego gniewu.
Piotrek poprawi≈Ç marynarkƒô i odwr√≥ci≈Ç siƒô do Samuela. ‚Äì Nastƒôpnym razem‚Ä¶ niech nie pr√≥bujƒÖ nawet wej≈õƒá do ≈õrodka.
Samuel skinƒÖ≈Ç g≈ÇowƒÖ. ‚Äì Zajmƒô siƒô tym, szefie.`
          },
          9: {
            title: "Porozumienie czy jednak go brak",
            text: `Deszcz sp≈Çywa≈Ç po maskach samochod√≥w jak stru≈ºki srebra, a grad bƒôbni≈Ç o dachy niczym karabinowa salwa. Samuel wraca≈Ç do domu, skulony w cieniu latarni, gdy nagle obok niego z piskiem opon zatrzyma≈Ça siƒô czarna furgonetka. Drzwi otworzy≈Çy siƒô z trzaskiem, a dw√≥ch zamaskowanych mƒô≈ºczyzn wciƒÖgnƒô≈Ço go do ≈õrodka.
‚Äì Ani s≈Çowa ‚Äì warknƒÖ≈Ç jeden, przyk≈ÇadajƒÖc lufƒô do jego g≈Çowy.
Samuel ledwie zdƒÖ≈ºy≈Ç zaczerpnƒÖƒá powietrza, gdy rozleg≈Ç siƒô huk. Kula przeszy≈Ça ciemno≈õƒá ‚Äì pad≈Ç pierwszy z oprawc√≥w, potem drugi. W drzwiach furgonetki sta≈Ç Piotrek, mokry od deszczu, z broniƒÖ w d≈Çoni.
‚Äì Uwa≈ºaj, Samuel! ‚Äì krzyknƒÖ≈Ç, celujƒÖc precyzyjnie.
Gdy ucich≈Çy ostatnie strza≈Çy, obaj wiedzieli, ≈ºe to nie by≈Ç przypadek. Kto≈õ ich wystawi≈Ç.
Noc pachnia≈Ça ≈ºelazem i dymem. W biurowcu panowa≈Ça cisza, a≈º nagle system alarmowy zawy≈Ç. Samuel i Piotrek wbiegli do ≈õrodka ‚Äì w centrum sali le≈ºa≈Ça bomba z migajƒÖcym odliczaniem.
‚Äì Na ziemiƒô! ‚Äì wrzasnƒÖ≈Ç kto≈õ z ochrony.
Zanim jednak licznik zbli≈ºy≈Ç siƒô do zera, z ciemnego korytarza wybieg≈Ç W≈Çadzimierz. KlƒôknƒÖ≈Ç przy urzƒÖdzeniu, z d≈ÇoniƒÖ pewnƒÖ i zimnƒÖ jak stal. Po kilku sekundach ciszy us≈Çyszano tylko klik ‚Äì odliczanie usta≈Ço.
‚Äì Gotowe ‚Äì powiedzia≈Ç spokojnie, wycierajƒÖc pot z czo≈Ça.
O ≈õwicie Piotrek us≈Çysza≈Ç niecierpliwy d≈∫wiƒôk dzwonka. Otworzy≈Ç drzwi ‚Äì na progu sta≈Ç Tymon, blady i roztrzƒôsiony.
‚Äì To wszystko wymyka siƒô spod kontroli ‚Äì powiedzia≈Ç ostro. ‚Äì Je≈õli nie przestaniesz, p√≥jdƒô na policjƒô.
Piotrek milcza≈Ç, patrzƒÖc mu prosto w oczy. W tej ciszy s≈Çychaƒá by≈Ço tylko szum deszczu za oknem.
Wtedy z cienia wysz≈Çy dwie znajome sylwetki ‚Äì rosyjscy kuzyni.
‚Äì Mamy problem, Piotrek ‚Äì rzuci≈Ç jeden z nich. ‚Äì I to du≈ºy.
Piotrek spojrza≈Ç na nich ch≈Çodno. Wiedzia≈Ç, ≈ºe ten dzie≈Ñ dopiero siƒô zaczyna, a ju≈º musi podejmowaƒá decyzje.`
          },
          10: {
            title: "Mi≈Ço≈õƒá zawsze ma koniec",
            text: `Piotrek czu≈Ç, ≈ºe dzia≈Ça pod presjƒÖ. My≈õli dudni≈Çy w g≈Çowie jak echo ‚Äî wszystko wymyka≈Ço siƒô spod kontroli.
Wsiad≈Ç do auta i pojecha≈Ç do Tymona. Gdy zapuka≈Ç do drzwi, otworzy≈Ça Lidia, dziewczyna jego brata. W jej oczach tli≈Ç siƒô lƒôk.
‚Äî Nie ma go ‚Äî powiedzia≈Ça kr√≥tko, pr√≥bujƒÖc zamknƒÖƒá drzwi.
Piotrek w≈õlizgnƒÖ≈Ç siƒô do ≈õrodka.
‚Äî Lidia, gdzie jest Tymon? ‚Äî zapyta≈Ç ch≈Çodno.
Wtedy wyzna≈Ça, ≈ºe Tymon opowiedzia≈Ç jej wszystko ‚Äî o mafii, o Kacprze, o tym, jak daleko to zasz≈Ço.
‚Äî On nie chce i≈õƒá na policjƒô‚Ä¶ ale ja p√≥jdƒô, je≈õli tego nie sko≈Ñczysz ‚Äî wyszepta≈Ça. ‚Äî Chcƒô go ratowaƒá.
S≈Çowa zawis≈Çy w powietrzu jak wyrok.
Piotrek nic nie odpowiedzia≈Ç. Wyszed≈Ç, zamknƒÖ≈Ç za sobƒÖ drzwi i wsiad≈Ç do auta.
Przez chwilƒô siedzia≈Ç w ciszy, po czym siƒôgnƒÖ≈Ç po telefon.
‚Äî Eryk‚Ä¶ mam dla was zlecenie.
Nastƒôpnego dnia Tymon wr√≥ci≈Ç do mieszkania. W salonie panowa≈Ça nienaturalna cisza.
Na stole le≈ºa≈Ça kartka. Na niej kilka s≈Ç√≥w, pisanych twardƒÖ rƒôkƒÖ:
‚ÄûTo przez ciebie Lidia nie ≈ºyje.‚Äù`
          },
          11: {
            title: "Zdrajca",
            text: `Tymon po zobaczeniu kartki zamar≈Ç. D≈Çonie mu dr≈ºa≈Çy, kartka wypada≈Ça z palc√≥w, a on nie m√≥g≈Ç z≈Çapaƒá tchu. Zanim zdƒÖ≈ºy≈Ç cokolwiek przemy≈õleƒá, siƒôgnƒÖ≈Ç po telefon i zadzwoni≈Ç.
‚Äî Piotrek‚Ä¶ przyjed≈∫. Teraz.
Kilka minut p√≥≈∫niej Piotrek sta≈Ç ju≈º w drzwiach. W mieszkaniu panowa≈Ça cisza.
‚Äî Dlaczego? ‚Äî zapyta≈Ç Tymon, g≈Çosem ≈ÇamiƒÖcym siƒô od gniewu i b√≥lu. ‚Äî Przecie≈º ja jƒÖ kocha≈Çem.
Piotrek spu≈õci≈Ç wzrok.
‚Äî Nie mia≈Çem wyboru‚Ä¶ Musia≈Çem. ‚Äî Podeszed≈Ç bli≈ºej, po≈Ço≈ºy≈Ç mu d≈Ço≈Ñ na ramieniu, a potem objƒÖ≈Ç go jak brata. ‚Äî Przepraszam.
Nie patrzƒÖc mu w oczy, odwr√≥ci≈Ç siƒô i wyszed≈Ç.
Chwilƒô p√≥≈∫niej do mieszkania wpadli kuzyni z Rosji. Ich kroki dudni≈Çy po schodach jak echo zemsty. Tymon nie zdƒÖ≈ºy≈Ç nawet siƒôgnƒÖƒá po telefon. Zanim opad≈Ç na pod≈Çogƒô, wiedzia≈Ç, ≈ºe to koniec.
Kilka godzin p√≥≈∫niej Piotrek dowiedzia≈Ç siƒô o wszystkim ‚Äî o ≈õmierci brata, o tym, ≈ºe za wszystkim sta≈Ç Ignacy. Spotkali siƒô w starym magazynie.
‚Äî Po co to zrobi≈Çe≈õ? ‚Äî spyta≈Ç Piotrek cicho.
Ignacy u≈õmiechnƒÖ≈Ç siƒô zimno.
‚Äî Bo nie jestem ju≈º z tobƒÖ. Wsp√≥≈Çpracujƒô z konkurencjƒÖ. To ja wys≈Ça≈Çem ludzi po Samuela.
Piotrek zamar≈Ç. Przez chwilƒô w jego oczach nie by≈Ço widaƒá gniewu ‚Äî tylko pustkƒô.`
          },
          12: {
            title: "Gdzie sƒÖ krople deszczu?",
            text: `Nic nie by≈Ço ju≈º takie samo. Kuzyni Piotrka zaczƒôli trzymaƒá z Ignacym, a sam Piotrek czu≈Ç, ≈ºe grunt usuwa mu siƒô spod n√≥g. Nie widzia≈Ç ju≈º sensu w ucieczkach, k≈Çamstwach i zbrodniach ‚Äî postanowi≈Ç zako≈Ñczyƒá to raz na zawsze.
Zorganizowa≈Ç spotkanie w opuszczonym magazynie. Zaprosi≈Ç wszystkich: konkurencjƒô, przeciwnƒÖ mafiƒô, Ignacego i Rosjan. Mia≈Ça to byƒá rozmowa ‚Äî ostatnia szansa na porozumienie.
Gdy napiƒôcie siƒôga≈Ço zenitu, Piotrek otworzy≈Ç usta, by przem√≥wiƒá... wtedy Ignacy krzyknƒÖ≈Ç tylko jedno s≈Çowo:
‚Äî Teraz!
Rozleg≈Ç siƒô huk. Wybuch≈Ça regularna wojna ‚Äî seria za seriƒÖ, krzyki, kurz i zapach prochu. Wkr√≥tce ka≈ºdy by≈Ç ranny. Po kilku minutach na nogach pozosta≈Ç ju≈º tylko Ignacy.
Piotrek spojrza≈Ç na niego z gniewem i b√≥lem.
‚Äî Jak mog≈Çe≈õ mi to zrobiƒá?! ‚Äî wrzasnƒÖ≈Ç, rzucajƒÖc siƒô na niego.
Ignacy upad≈Ç, a Piotrek ≈õciƒÖgnƒÖ≈Ç mu szalik z szyi i zaczƒÖ≈Ç nim dusiƒá. Cisza po walce by≈Ça przerywana tylko ich oddechami.`
          },
          13: {
            title: "Krople z ekspresu",
            text: `Piotrek nalewa≈Ç sobie kawƒô z ekspresu, a w powietrzu unosi≈Ç siƒô zapach gorzkich ziaren i ciep≈Ça ‚Äî jakby ka≈ºda chwila mia≈Ça smak ulgi. Wszystko ju≈º ucich≈Ço. Wojna, krzyk, zdrady ‚Äì przeminƒô≈Çy jak sen. Krople m≈ºawki nie spada≈Çy ju≈º na jego ramiona, bo wreszcie mia≈Ç nad sobƒÖ dach i spok√≥j, na kt√≥ry tak d≈Çugo czeka≈Ç.
Wyszed≈Ç na balkon. Miasto spa≈Ço, a z rynny skapnƒô≈Ça na jego d≈Ço≈Ñ jedna, samotna kropla deszczu. Spojrza≈Ç na niƒÖ w ciszy i u≈õmiechnƒÖ≈Ç siƒô ‚Äî przypomnia≈Ç sobie, jak bardzo zawsze je kocha≈Ç.
Odwr√≥ci≈Ç siƒô powoli i wr√≥ci≈Ç do biurka. Na stole parowa≈Ça kawa, a on wziƒÖ≈Ç ≈Çyk, czujƒÖc, ≈ºe tym razem naprawdƒô mo≈ºe ju≈º odpoczƒÖƒá.`
          }
        }
      };
      // ---- UI referencje ----
      const badEndingBtn = document.getElementById('badEndingBtn');
      const slotBtn = document.getElementById('slotBtn');
      const seasonArea = document.getElementById('seasonArea');
      const chapterArea = document.getElementById('chapterArea');
      const chapterContent = document.getElementById('chapterContent');
      const slotMachine = document.getElementById('slotMachine');
      const drawBtn = document.getElementById('drawBtn');
      const clearBtn = document.getElementById('clearBtn');
      const slotsDiv = document.getElementById('slots');
      const slotMsg = document.getElementById('slotMsg');
      const backBtn = document.getElementById('backBtn');
      const mainMenu = document.getElementById('mainMenu');
      // ---- Helper: clear views ----
      function hideAllViews() {
        seasonArea.style.display = 'none';
        chapterArea.style.display = 'none';
        chapterContent.style.display = 'none';
        slotMachine.style.display = 'none';
        backBtn.style.display = 'none';
        mainMenu.style.display = 'flex';
      }
      // ---- Show seasons (only 2 seasons) ----
      function showSeasons() {
        mainMenu.style.display = 'none';
        slotMachine.style.display = 'none';
        chapterContent.style.display = 'none';
        chapterArea.style.display = 'none';
        seasonArea.innerHTML = '';
        // Season 1
        const s1 = document.createElement('button');
        s1.className = 'season-btn';
        s1.textContent = season1.title;
        s1.onclick = () => showChapters(1);
        seasonArea.appendChild(s1);
        // Season 2
        const s2 = document.createElement('button');
        s2.className = 'season-btn';
        s2.textContent = season2.title;
        s2.onclick = () => showChapters(2);
        seasonArea.appendChild(s2);
        seasonArea.style.display = 'flex';
        backBtn.style.display = 'block';
      }
      // ---- Show chapters for chosen season ----
      function showChapters(seasonId) {
        seasonArea.style.display = 'none';
        chapterArea.innerHTML = '';
        let chapters = (seasonId === 1) ? season1.chapters : season2.chapters;
        for (const numStr of Object.keys(chapters)) {
          const num = Number(numStr);
          const b = document.createElement('button');
          b.className = 'chapter-btn';
          b.textContent = `Rozdzia≈Ç ${num} ‚Äî ${chapters[num].title}`;
          b.onclick = () => displayChapter(seasonId, num);
          chapterArea.appendChild(b);
        }
        chapterArea.style.display = 'flex';
        backBtn.style.display = 'block';
      }
      // ---- Display selected chapter ----
      function displayChapter(seasonId, chapterNum) {
        chapterArea.style.display = 'none';
        const chapters = (seasonId === 1) ? season1.chapters : season2.chapters;
        chapterContent.textContent = `${chapters[chapterNum].title}\n\n${chapters[chapterNum].text}`;
        chapterContent.style.display = 'block';
        backBtn.style.display = 'block';
      }
      // ---- Slot machine: weighted selection ----
      const slotSymbols = [{
          icon: 'üçã',
          chance: 30
        },
        {
          icon: 'üçä',
          chance: 25
        },
        {
          icon: 'üçá',
          chance: 20
        },
        {
          icon: 'üçí',
          chance: 15
        },
        {
          icon: 'üí∞',
          chance: 6
        },
        {
          icon: 'üõéÔ∏è',
          chance: 3
        },
        {
          icon: '7',
          chance: 1
        } // we'll render as red7
      ];

      function weightedPick() {
        const r = Math.random() * 100;
        let cum = 0;
        for (const s of slotSymbols) {
          cum += s.chance;
          if (r <= cum) return s.icon;
        }
        return slotSymbols[slotSymbols.length - 1].icon;
      }

      function spinOnce() {
        const res = [];
        for (let i = 0; i < 3; i++) {
          res.push(weightedPick());
        }
        // Render with red 7 specially
        slotsDiv.innerHTML = res.map(x => x === '7' ? `<span class="red7">7</span>` : x).join(' ');
        // Message logic
        const counts = {};
        res.forEach(r => counts[r] = (counts[r] || 0) + 1);
        if (res.every(x => x === '7')) {
          slotMsg.textContent = "JACKPOT! Trzy czerwone 7! üéâ";
        } else if (Object.values(counts).some(c => c === 3)) {
          slotMsg.textContent = "Trzy takie same! Dobra robota.";
        } else if (Object.values(counts).some(c => c === 2)) {
          slotMsg.textContent = "Dwie takie same ‚Äî prawie jackpot!";
        } else {
          slotMsg.textContent = "Nic tym razem ‚Äî spr√≥buj ponownie.";
        }
      }
      // ---- Events ----
      badEndingBtn.addEventListener('click', () => {
        hideAllViews();
        showSeasons();
      });
      slotBtn.addEventListener('click', () => {
        hideAllViews();
        slotMachine.style.display = 'block';
        backBtn.style.display = 'block';
        mainMenu.style.display = 'none';
      });
      drawBtn && drawBtn.addEventListener('click', spinOnce);
      drawBtn && drawBtn.addEventListener('click', () => {}); // no-op if missing
      drawBtn && drawBtn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') spinOnce();
      });
      document.getElementById('drawBtn').addEventListener('click', spinOnce);
      clearBtn.addEventListener('click', () => {
        slotsDiv.innerHTML = 'üé∞ üé∞ üé∞';
        slotMsg.textContent = '';
      });
      backBtn.addEventListener('click', () => {
        hideAllViews();
      });
      // Init: show main menu
      hideAllViews();
    </script>
  </body>

<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Face Analyzer - by Lnp7890</title>
<style>
:root{
  --bg:#070203;
  --panel:#170404;
  --card:#1a0606;
  --accent1:#ff3b2f;
  --accent2:#ff8a6b;
  --muted:#d6c6c3;
  --glass: rgba(255,255,255,0.03);
  --radius:14px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:20px; font-family:Inter,system-ui,Arial;
  background: linear-gradient(180deg,#040101 0%, #120307 60%);
  color:#fff; display:flex; flex-direction:column; align-items:center;
}

/* Force vertical stacking under #automat */
#automat { width:100%; max-width:980px; margin-bottom:28px; }

/* Container */
.container{ width:100%; max-width:980px; background:var(--panel); border-radius:var(--radius); padding:16px; box-shadow:0 18px 60px rgba(0,0,0,0.6); }
.header{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; }
.title{ font-weight:900; font-size:18px; background:linear-gradient(90deg,var(--accent1),var(--accent2)); -webkit-background-clip:text; color:transparent; }
.subtitle{ font-size:13px; color:var(--muted); }

/* Preview */
.preview{ background: linear-gradient(180deg,#260606,#120304); border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:10px; align-items:center; }
#previewImg{ max-width:100%; border-radius:10px; object-fit:contain; display:none; box-shadow:0 8px 30px rgba(0,0,0,0.6); }

/* Controls */
.controls{ display:flex; gap:8px; align-items:center; width:100%; flex-wrap:wrap; }
.file-btn{ padding:10px 12px; border-radius:10px; border:1px dashed rgba(255,255,255,0.06); color:var(--muted); background:transparent; cursor:pointer; }
.btn{ padding:10px 12px; border-radius:10px; border:none; cursor:pointer; font-weight:800; color:#200503; background:linear-gradient(90deg,var(--accent2),var(--accent1)); }
.small{ font-size:12px; color:var(--muted); }

/* progress */
.progress { height:10px; width:100%; background:rgba(255,255,255,0.02); border-radius:999px; overflow:hidden; margin-top:6px; }
.progress > i { display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent1),var(--accent2)); transition:width 350ms ease; }

/* Results vertical */
.results-grid{ margin-top:12px; display:flex; flex-direction:column; gap:10px; width:100%; }
.result-row{ display:flex; gap:12px; align-items:center; background:var(--glass); padding:10px; border-radius:10px; min-height:84px; position:relative; }
.ring{ width:86px; height:86px; border-radius:50%; background:#0d0706; display:flex; align-items:center; justify-content:center; position:relative; box-shadow: 0 8px 30px rgba(0,0,0,0.5); }
.value{ font-weight:900; font-size:20px; color:#fff; text-shadow:0 1px 0 rgba(0,0,0,0.6); }
.label{ font-size:15px; color:var(--muted); font-weight:800; }
.sub{ font-size:12px; color:var(--muted); }

/* suggestion bubble (on the right of each row) */
.suggestions{ position:absolute; right:12px; top:12px; max-width:42%; background:rgba(0,0,0,0.35); padding:8px 10px; border-radius:8px; color:var(--muted); font-size:12px; }
.suggestion-item{ margin-bottom:6px; }
.suggestion-item:last-child{ margin-bottom:0; }

/* save report area */
.save-area{ display:flex; gap:8px; margin-top:12px; align-items:center; }

/* small screens */
@media (max-width:720px){
  .result-row{ padding:8px; gap:8px; }
  .ring{ width:68px; height:68px; }
  .value{ font-size:16px; }
  .suggestions{ position:static; max-width:100%; margin-top:8px; }
  .results-grid{ gap:8px; }
  .save-area{ flex-direction:column; align-items:stretch; }
}
</style>
</head>
<body>
  <!-- If your automat exists elsewhere give it id="automat". This script will insert analyzer under it. -->
  <div id="automat" style="display:none"></div>

  <div class="container" id="face-analyzer-container" aria-live="polite">
    <div class="header">
      <div>
        <div class="title">Face Analyzer - by Lnp7890</div>
        <div class="subtitle">Zachowano: 3√ó metody ¬∑ 7 eye types ¬∑ 7 face shapes ¬∑ wa≈ºony overall</div>
      </div>
      <div id="status" class="subtitle">Rozpoczynam inicjalizacjƒô modeli...</div>
    </div>

    <div class="preview">
      <img id="previewImg" alt="PodglƒÖd zdjƒôcia"/>
      <div id="hint" class="small">Wybierz zdjƒôcie JPG/PNG/WebP ‚Äî analiza zacznie siƒô po wykryciu twarzy</div>

      <div class="controls">
        <label class="file-btn" id="uploadLabel">Wybierz zdjƒôcie
          <input id="fileInput" type="file" accept="image/*" style="display:none" />
        </label>
        <button id="changeBtn" class="btn" style="display:none">Zmie≈Ñ zdjƒôcie</button>
        <div style="flex:1">
          <div style="display:flex; justify-content:space-between; font-size:13px; color:var(--muted); margin-bottom:6px;">
            <div id="loaderText">≈Åadowanie modeli</div><div id="countdown">20s</div>
          </div>
          <div class="progress"><i id="progFill"></i></div>
        </div>
      </div>

      <div id="modeNote" class="small" style="margin-top:6px">Tryb: oczekiwanie na modele...</div>

      <div id="resultsGrid" class="results-grid" role="region" aria-live="polite"></div>

      <div class="save-area">
        <button id="saveReportBtn" class="btn">üíæ Zapisz raport</button>
        <div id="savedNotice" class="small" style="color:var(--muted)"></div>
      </div>

      <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
        <div class="small">Eye types: Hunter, Almond, Hooded, Monolid, Downturned, Upturned, Wide-set</div>
        <div class="small" id="footerMsg">FaceShapes: Diamond, Oval, Round, Square, Heart, Triangle, Rectangle</div>
      </div>
    </div>
  </div>

<script>
/* Final integrated script:
   - loader: tf -> blazeface -> facemesh (retry, timeout, countdown, progress)
   - BlazeFace detection first (no face => "Nie wykryto twarzy")
   - 3-method scoring for each metric (jawline, faceShape, eyes, cheekbones, symmetry, skin, proportions, chin, ratio)
   - suggestions: up to 10 per category (natural language), verify by predicate, re-evaluate metric if predicate false
   - export report (JSON/TXT)
   - vertical layout under #automat
*/

/* ---------- Utilities ---------- */
const clamp = (v,a,b) => Math.max(a, Math.min(b, v));
const mean = arr => arr.length ? arr.reduce((s,x)=>s+x,0)/arr.length : 0;
const dist = (a,b) => {
  if(!a||!b) return 0;
  const ax = a[0] ?? a.x, ay = a[1] ?? a.y;
  const bx = b[0] ?? b.x, by = b[1] ?? b.y;
  return Math.hypot(ax-bx, ay-by);
};

/* ---------- DOM ---------- */
const statusEl = document.getElementById('status');
const loaderText = document.getElementById('loaderText');
const uploadLabel = document.getElementById('uploadLabel');
const fileInput = document.getElementById('fileInput');
const previewImg = document.getElementById('previewImg');
const changeBtn = document.getElementById('changeBtn');
const countdownEl = document.getElementById('countdown');
const progFill = document.getElementById('progFill');
const resultsGrid = document.getElementById('resultsGrid');
const modeNote = document.getElementById('modeNote');
const hint = document.getElementById('hint');
const footerMsg = document.getElementById('footerMsg');
const saveReportBtn = document.getElementById('saveReportBtn');
const savedNotice = document.getElementById('savedNotice');

let blazefaceModel = null;
let meshModel = null;
let READY = false;
let ONLINE = false;
let countdown = 20;

/* data to export later */
let analysisResults = null;             // simple mapping key->value
let improvementSuggestions = {};       // category -> array of confirmed suggestions
let rawSuggestionCandidates = {};      // category -> array of candidates (unconfirmed)

/* place analyzer under automat (vertical) */
(function placeUnderAutomat(){
  const triesMax = 20; let tries=0;
  const iv = setInterval(()=>{
    tries++;
    const automat = document.getElementById('automat');
    const container = document.getElementById('face-analyzer-container');
    if(automat && container){ automat.insertAdjacentElement('afterend', container); clearInterval(iv); }
    if(tries>=triesMax) clearInterval(iv);
  },400);
})();

function setProgress(p){ progFill.style.width = clamp(p,0,100) + '%'; }

/* animate ring for display */
function animateRing(el, value){
  return new Promise(res=>{
    const target = clamp(Math.round(value),0,100);
    const valEl = el.querySelector('.value');
    const start = performance.now(); const dur = 700;
    function frame(now){
      const t = clamp((now-start)/dur,0,1);
      const eased = 1 - Math.pow(1 - t, 3);
      const cur = Math.round(target * eased);
      el.style.background = `conic-gradient(#ff3b2f ${cur*3.6}deg, rgba(0,0,0,0.45) ${cur*3.6}deg)`;
      if(valEl) valEl.textContent = cur;
      if(t < 1) requestAnimationFrame(frame); else res();
    }
    requestAnimationFrame(frame);
  });
}
function createRow(label, subtitle){
  const row = document.createElement('div'); row.className='result-row';
  const ring = document.createElement('div'); ring.className='ring';
  const v = document.createElement('div'); v.className='value'; v.textContent='0';
  ring.appendChild(v);
  const text = document.createElement('div'); text.style.flex='1';
  const lbl = document.createElement('div'); lbl.className='label'; lbl.textContent=label;
  const sub = document.createElement('div'); sub.className='sub'; sub.textContent=subtitle||'';
  text.appendChild(lbl); text.appendChild(sub);
  row.appendChild(ring); row.appendChild(text);
  return { row, ring, v, text, labelEl: lbl };
}

/* ---------- Load scripts with retries & timeout ---------- */
async function loadScript(src, timeout=9000){
  return new Promise((res, rej)=>{
    const s = document.createElement('script'); s.src = src; s.async = true;
    let done=false;
    const to = setTimeout(()=>{ if(!done){ done=true; s.remove(); rej(new Error('timeout')); } }, timeout);
    s.onload = ()=>{ if(done) return; done=true; clearTimeout(to); res(); };
    s.onerror = (e)=>{ if(done) return; done=true; clearTimeout(to); rej(e); };
    document.head.appendChild(s);
  });
}

async function attemptLoadAll(attempts=3){
  for(let i=1;i<=attempts;i++){
    statusEl.textContent = `≈Åadowanie modeli online (pr√≥ba ${i}/${attempts})...`;
    setProgress(10 + (i-1)*30);
    try{
      if(typeof tf === 'undefined') await loadScript('https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.18.0/dist/tf.min.js', 9000);
      setProgress(30);
      if(typeof blazeface === 'undefined') await loadScript('https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7/dist/blazeface.min.js', 9000);
      setProgress(55);
      if(typeof faceLandmarksDetection === 'undefined') await loadScript('https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@1.0.3/dist/face-landmarks-detection.min.js', 9000);
      setProgress(75);
      try{ await tf.setBackend('webgl'); }catch(e){ try{ await tf.setBackend('cpu'); }catch(_){} }
      await tf.ready();
      blazefaceModel = await blazeface.load();
      setProgress(88);
      meshModel = await faceLandmarksDetection.load(faceLandmarksDetection.SupportedPackages.mediapipeFacemesh, { maxFaces:1 });
      setProgress(100);
      statusEl.textContent = 'Modele za≈Çadowane ‚úÖ';
      modeNote.textContent = 'Tryb: ONLINE (BlazeFace + FaceMesh)';
      ONLINE = true; READY = true;
      return true;
    } catch(err){
      console.warn('load attempt failed', err);
      statusEl.textContent = `B≈ÇƒÖd ≈Çadowania (pr√≥ba ${i}) ‚Äî ${err.message||''}`;
      setProgress(Math.min(85, 10 + i*20));
      await new Promise(r=>setTimeout(r, 1000 + i*600));
    }
  }
  statusEl.textContent = 'Nie uda≈Ço siƒô za≈Çadowaƒá modeli ‚Äî tryb OFFLINE.';
  modeNote.textContent = 'Tryb: OFFLINE (heurystyki)';
  READY = true; ONLINE = false;
  setProgress(15);
  return false;
}

/* start countdown + initial load */
countdownEl.textContent = countdown + 's';
const cdIv = setInterval(()=>{
  countdown--;
  countdownEl.textContent = countdown + 's';
  setProgress((20 - countdown)/20 * 35 + 5);
  if(countdown <= 0){
    clearInterval(cdIv);
    attemptLoadAll(3);
  }
},1000);
attemptLoadAll(3).catch(()=>{ /* fallback handled above */ });

/* ---------- Scoring functions (improved) ----------
   We'll reuse the advanced scoring functions from previous versions:
   - jawline (3 methods)
   - faceShape (3 methods) + mapping to 7 shapes
   - eyes (3 methods) + mapping to 7 types
   - cheekbones (3), symmetry (3), skin (3), proportions (3), chin (3), ratio (3)
   The functions below are condensed but full-featured and defensive.
*/

/* helper meshBox */
function meshBox(mesh){ if(!mesh||!mesh.length) return null; const xs = mesh.map(p=>p[0]), ys = mesh.map(p=>p[1]); return { x: Math.min(...xs), y: Math.min(...ys), width: Math.max(...xs)-Math.min(...xs), height: Math.max(...ys)-Math.min(...ys) }; }

/* JAWLINE */
function jaw_mA(ann, box){ try{ const s=ann.silhouette||[]; const left=s[10]||s[0], right=s[s.length-11]||s[s.length-1]; const chin=s[Math.floor(s.length/2)]||s[152]||[box.x+box.width/2,box.y+box.height]; if(!left||!right||!chin) return 50; const la=Math.abs(Math.atan2(chin[1]-left[1],chin[0]-left[0]))*180/Math.PI; const ra=Math.abs(Math.atan2(chin[1]-right[1],chin[0]-right[0]))*180/Math.PI; const avg=(la+ra)/2; const sharp=clamp((140-avg)/60,0,1)*100; const sym=100-Math.abs(la-ra); return Math.round(clamp(sharp*0.7+sym*0.3,0,100)); }catch(e){return 50;} }
function jaw_mB(ann, box){ try{ const s=ann.silhouette||[]; const left=s[0]||[box.x+box.width*0.15,box.y+box.height], right=s[s.length-1]||[box.x+box.width*0.85,box.y+box.height]; const chin=s[Math.floor(s.length/2)]||[box.x+box.width/2,box.y+box.height]; const mid=[(left[0]+right[0])/2,(left[1]+right[1])/2]; const proj=dist(chin,mid); const rel=proj/Math.max(1,box.height); return Math.round(clamp((rel-0.08)/0.2,0,1)*100);}catch(e){return 50;} }
function jaw_mC(ann, box){ try{ const s=ann.silhouette||[]; if(s.length<8) return 50; const len=s.length; const idxL=Math.floor(len*0.15), idxR=Math.floor(len*0.85); function cur(i){const p=s[i]; const p1=s[Math.max(0,i-3)], p2=s[Math.min(len-1,i+3)]; const a=dist(p1,p), b=dist(p,p2), c=dist(p1,p2); if(c===0) return 0; return Math.abs((a+b-c)/c);} const cval=mean([cur(idxL),cur(idxR)]); return Math.round(clamp(1-cval*3,0,1)*100);}catch(e){return 50;} }
function jaw_score(ann,box){ return Math.round(mean([jaw_mA(ann,box),jaw_mB(ann,box),jaw_mC(ann,box)])); }

/* FACE SHAPE */
function faceShape_mA(ann,box){ try{ const leftTemple=ann.leftEyeUpper0?.[0]||[box.x+box.width*0.28,box.y+box.height*0.25]; const rightTemple=ann.rightEyeUpper0?.slice(-1)?.[0]||[box.x+box.width*0.72,box.y+box.height*0.25]; const leftCheek=ann.leftCheek?.[0]||[box.x+box.width*0.28,box.y+box.height*0.45]; const rightCheek=ann.rightCheek?.[0]||[box.x+box.width*0.72,box.y+box.height*0.45]; const jawLeft=ann.silhouette?.[10]||[box.x+box.width*0.15,box.y+box.height]; const jawRight=ann.silhouette?.slice(-11)?.[0]||[box.x+box.width*0.85,box.y+box.height]; const topW=dist(leftTemple,rightTemple), midW=dist(leftCheek,rightCheek), jawW=dist(jawLeft,jawRight); const chin=ann.silhouette?.[Math.floor((ann.silhouette?.length||0)/2)]||[box.x+box.width/2,box.y+box.height]; const browY=ann.leftEyebrowUpper?.[2]?.[1]||box.y+box.height*0.2; const faceH=Math.max(1,Math.abs(chin[1]-browY)); const rMid=midW/faceH; return Math.round(clamp(1-Math.abs(rMid-0.32)/0.2,0,1)*100);}catch(e){return 50;} }
function faceShape_mB(ann,box){ try{ const s=ann.silhouette||[]; const len=s.length; const jawLeft=s[0]||[box.x+box.width*0.15,box.y+box.height]; const jawRight=s[len-1]||[box.x+box.width*0.85,box.y+box.height]; const leftCheek=ann.leftCheek?.[0]||[box.x+box.width*0.28,box.y+box.height*0.45]; const rightCheek=ann.rightCheek?.[0]||[box.x+box.width*0.72,box.y+box.height*0.45]; const wTop=Math.abs((ann.leftEyeUpper0?.[0]?.[0]||box.x+box.width*0.3)-(ann.rightEyeUpper0?.slice(-1)?.[0]?.[0]||box.x+box.width*0.7)); const wMid=dist(leftCheek,rightCheek); const wJaw=dist(jawLeft,jawRight); const diff=Math.abs(wTop-wJaw)/Math.max(1,wMid); return Math.round(clamp(1-diff/0.2,0,1)*100);}catch(e){return 50;} }
function faceShape_mC(ann,box){ try{ const mesh=ann.scaledMesh||ann; const b=meshBox(mesh); if(!b) return 50; const r=b.height/Math.max(1,b.width); return Math.round(clamp(1-Math.abs(r-1.35)/0.6,0,1)*100);}catch(e){return 50;} }
function faceShape_score(ann,box){ return Math.round(mean([faceShape_mA(ann,box),faceShape_mB(ann,box),faceShape_mC(ann,box)])); }

const FACE_SHAPES = ['Diamond','Oval','Round','Square','Heart','Triangle','Rectangle'];
function detectFaceShape(ann,box){ try{ const leftCheek=ann.leftCheek?.[0]||[box.x+box.width*0.28,box.y+box.height*0.45]; const rightCheek=ann.rightCheek?.[0]||[box.x+box.width*0.72,box.y+box.height*0.45]; const jawLeft=ann.silhouette?.[10]||[box.x+box.width*0.15,box.y+box.height]; const jawRight=ann.silhouette?.slice(-11)?.[0]||[box.x+box.width*0.85,box.y+box.height]; const browLeft=ann.leftEyebrowUpper?.[2]||[box.x+box.width*0.35,box.y+box.height*0.2]; const browRight=ann.rightEyebrowUpper?.[2]||[box.x+box.width*0.65,box.y+box.height*0.2]; const topW=dist(browLeft,browRight); const midW=dist(leftCheek,rightCheek); const jawW=dist(jawLeft,jawRight); const b2=meshBox(ann.scaledMesh||ann)||box; const h=b2?b2.height:box.height||1; const ratio=h/Math.max(1,midW); if(topW<jawW*0.9 && ratio>1.35) return 'Diamond'; if(Math.abs(topW-jawW)<midW*0.08 && ratio>1.25) return 'Oval'; if(Math.abs(topW-jawW)<midW*0.07 && ratio<1.15) return 'Round'; if(Math.abs(topW-jawW)<midW*0.06 && ratio>1.15) return 'Square'; if(topW>jawW*1.05 && ratio>1.20) return 'Heart'; if(jawW>midW*1.05 && ratio<1.1) return 'Triangle'; if(ratio>1.45) return 'Rectangle'; if(ratio>=1.30) return 'Oval'; if(ratio>=1.15) return 'Square'; return 'Round'; }catch(e){return 'Unknown';} }

/* EYES */
const EYE_TYPES = ['Hunter','Almond','Hooded','Monolid','Downturned','Upturned','Wide-set'];
function eyes_mA(ann,box){ try{ const left=ann.leftEye||[], right=ann.rightEye||[]; function ear(p){ if(!p||p.length<6) return 0.12; const A=dist(p[1],p[5]), B=dist(p[2],p[4]); const C=Math.max(1,dist(p[0],p[3])); return (A+B)/(2*C); } const v=(ear(left)+ear(right))/2; return Math.round(clamp((v-0.08)/0.5,0,1)*100);}catch(e){return 50;} }
function eyes_mB(ann,box){ try{ const leftOuter=ann.leftEyeLower0?.[0]||ann.leftEye?.[0]||[box.x+box.width*0.32,0]; const rightOuter=(ann.rightEyeLower0?.slice(-1)||ann.rightEye?.slice(-1))[0]||[box.x+box.width*0.68,0]; const inter=dist(leftOuter,rightOuter); const faceW=box.width||1; const rel=inter/faceW; return Math.round(clamp(1-Math.abs(rel-0.32)/0.2,0,1)*100);}catch(e){return 50;} }
function eyes_mC(ann,box){ try{ const left=ann.leftEye||[], right=ann.rightEye||[]; function openness(p){ if(!p||p.length<6) return 0.12; return (dist(p[1],p[5])+dist(p[2],p[4]))/(2*Math.max(1,dist(p[0],p[3]))); } const open=(openness(left)+openness(right))/2; return Math.round(clamp((open-0.08)/0.5,0,1)*100);}catch(e){return 50;} }
function mapEyeType(ann,box){ try{ const left=ann.leftEye||[], right=ann.rightEye||[]; const faceW=box.width||1; const inter=dist(left[0]||[0,0], right[3]||[0,0]); const interRel=inter/Math.max(1,faceW); const open=eyes_mC(ann,box)/100; if(open>0.45 && interRel<0.35) return 'Hunter'; if(open>0.35 && interRel>=0.32 && interRel<=0.40) return 'Almond'; if(open<0.16) return 'Monolid'; if(open<0.28) return 'Hooded'; if(interRel>0.42) return 'Wide-set'; if(open>0.25 && interRel<0.30) return 'Upturned'; if(open>0.20 && interRel<0.28) return 'Downturned'; return 'Almond'; }catch(e){return 'Almond';} }

/* CHEEKBONES */
function cheek_mA(ann,box){ try{ const l=ann.leftCheek?.[0]||[box.x+box.width*0.28,box.y+box.height*0.45]; const r=ann.rightCheek?.[0]||[box.x+box.width*0.72,box.y+box.height*0.45]; const w=dist(l,r)/Math.max(1,box.width); return Math.round(clamp((w-0.26)/0.18,0,1)*100);}catch(e){return 50;} }
function cheek_mB(ann,box){ try{ const cheekY=((ann.leftCheek?.[0]?.[1]||0)+(ann.rightCheek?.[0]?.[1]||0))/2; const chinY=ann.silhouette?.[152]?.[1]||box.y+box.height; const browY=ann.leftEyebrowUpper?.[2]?.[1]||box.y; const rel=(chinY-cheekY)/Math.max(1,chinY-browY); return Math.round(clamp(1-Math.abs(rel-0.48)/0.4,0,1)*100);}catch(e){return 50;} }
function cheek_mC(ann,box){ try{ const l=ann.leftCheek?.[0]||[0,0], r=ann.rightCheek?.[0]||[0,0]; const cheekW=dist(l,r); const faceW=box.width||1; return Math.round(clamp((cheekW/faceW - 0.28)/0.17,0,1)*100);}catch(e){return 50;} }
function cheek_score(ann,box){ return Math.round(mean([cheek_mA(ann,box),cheek_mB(ann,box),cheek_mC(ann,box)])); }

/* SYMMETRY */
function sym_mA(ann,box){ try{ const pts=ann.silhouette||[]; if(!pts.length) return 50; const cx=box.x+box.width/2; const pairs=[[33,263],[159,386],[133,362]]; const diffs=pairs.map(([l,r])=>{ const L=pts[l]||pts[0], R=pts[r]||pts[pts.length-1]; return Math.abs(Math.abs(L[0]-cx)-Math.abs(R[0]-cx)); }); const md=mean(diffs); return Math.round(clamp(1-md/Math.max(1,box.width)/0.08,0,1)*100);}catch(e){return 50;} }
function sym_mB(ann,box){ try{ const pts=ann.silhouette||[]; const leftAvg=mean(pts.slice(0,Math.floor(pts.length/2)).map(p=>p[0])); const rightAvg=mean(pts.slice(Math.floor(pts.length/2)).map(p=>p[0])); const diff=Math.abs(leftAvg-rightAvg)/Math.max(1,box.width); return Math.round(clamp(1-diff/0.2,0,1)*100);}catch(e){return 50;} }
function sym_mC(ann,box){ try{ const pairs=[[36,45],[39,42],[48,54]]; const pts=ann.silhouette||[]; let s=0; pairs.forEach(([l,r])=> s+=Math.abs((pts[l]?.[0]||0)-(pts[r]?.[0]||0))); return Math.round(clamp(1-(s/3)/Math.max(1,box.width)/0.06,0,1)*100);}catch(e){return 50;} }
function sym_score(ann,box){ return Math.round(mean([sym_mA(ann,box),sym_mB(ann,box),sym_mC(ann,box)])); }

/* SKIN (sampling) */
function skin_sample_stats(ctx,sx,sy,w,h){ try{ const data=ctx.getImageData(sx,sy,w,h).data; const lum=[], rg=[]; let skinLike=0,total=0; for(let i=0;i<data.length;i+=4){ const r=data[i], g=data[i+1], b=data[i+2]; const L=0.2126*r+0.7152*g+0.0722*b; lum.push(L); rg.push(Math.abs(r-g)); if(r>50 && g>35 && b>25 && r>g && r>b) skinLike++; total++; } const meanL=mean(lum); const variance=lum.reduce((s,v)=>s+(v-meanL)*(v-meanL),0)/Math.max(1,lum.length); const std=Math.sqrt(Math.max(0,variance)); const meanRG=mean(rg); return {std, prop: skinLike/Math.max(1,total), meanL, meanRG}; }catch(e){return {std:40, prop:0.6, meanL:130, meanRG:20}; } }
function skin_mA(ctx, scaledBox){ try{ const w=Math.max(6, Math.round(scaledBox.width*0.18)), h=Math.max(6, Math.round(scaledBox.height*0.08)); const x1=clamp(Math.round(scaledBox.x+scaledBox.width*0.25),0,ctx.canvas.width-1); const y1=clamp(Math.round(scaledBox.y+scaledBox.height*0.36),0,ctx.canvas.height-1); const x2=clamp(Math.round(scaledBox.x+scaledBox.width*0.65),0,ctx.canvas.width-1); const y2=y1; const s1=skin_sample_stats(ctx,x1,y1,Math.min(w,ctx.canvas.width-x1),Math.min(h,ctx.canvas.height-y1)); const s2=skin_sample_stats(ctx,x2,y2,Math.min(w,ctx.canvas.width-x2),Math.min(h,ctx.canvas.height-y2)); const smooth=clamp(1-mean([s1.std,s2.std])/60,0,1); const prop=clamp(mean([s1.prop,s2.prop]),0,1); return Math.round((smooth*0.7+prop*0.3)*100);}catch(e){return 60;} }
function skin_mB(ctx, scaledBox){ try{ const w=Math.max(6, Math.round(scaledBox.width*0.2)), h=Math.max(6, Math.round(scaledBox.height*0.12)); const x=clamp(Math.round(scaledBox.x+scaledBox.width*0.4),0,ctx.canvas.width-1); const y=clamp(Math.round(scaledBox.y+scaledBox.height*0.44),0,ctx.canvas.height-1); const s=skin_sample_stats(ctx,x,y,Math.min(w,ctx.canvas.width-x),Math.min(h,ctx.canvas.height-y)); const colorUniform=clamp(1-s.meanRG/70,0,1); return Math.round((colorUniform*0.6+clamp(1-s.std/50,0,1)*0.4)*100);}catch(e){return 65;} }
function skin_mC(ctx, scaledBox){ try{ const w=Math.max(6, Math.round(scaledBox.width*0.25)), h=Math.max(6, Math.round(scaledBox.height*0.14)); const x=clamp(Math.round(scaledBox.x+scaledBox.width*0.35),0,ctx.canvas.width-1); const y=clamp(Math.round(scaledBox.y+scaledBox.height*0.4),0,ctx.canvas.height-1); const s=skin_sample_stats(ctx,x,y,Math.min(w,ctx.canvas.width-x),Math.min(h,ctx.canvas.height-y)); return Math.round(clamp(1-s.std/55,0,1)*100);}catch(e){return 60;} }
function skin_score(ctx, scaledBox){ const a=skin_mA(ctx,scaledBox), b=skin_mB(ctx,scaledBox), c=skin_mC(ctx,scaledBox); return Math.round(mean([a,b,c])); }

/* PROPORTIONS/CHIN/RATIO */
function proportions_methods_ann(ann,box){ try{ const leftEye=ann.leftEye||[], rightEye=ann.rightEye||[]; const eyeCenterY=mean(leftEye.concat(rightEye).map(p=>p[1]))||0; const mouthY=mean((ann.lipsUpperOuter||[]).map(p=>p[1]))||0; const chinY=ann.silhouette?.[152]?.[1]||(box.y+box.height); const d1=mouthY-eyeCenterY, d2=chinY-mouthY; const ratio=d1/Math.max(1,d1+d2); const m1=clamp(1-Math.abs(ratio-0.33)/0.5,0,1)*100; const browY=ann.leftEyebrowUpper?.[2]?.[1]||0; const noseY=ann.noseTip?.[0]?.[1]||0; const total=Math.max(1,chinY-browY); const a=noseY-browY, b2=mouthY-noseY, c=chinY-mouthY; const thirds=[a/total||0,b2/total||0,c/total||0]; const dev=mean(thirds.map(t=>Math.abs(t-1/3))); const m2=clamp(1-dev*3,0,1)*100; const leftW=dist(ann.silhouette?.[0]||[0,0], ann.silhouette?.[152]||[0,0]); const rightW=dist(ann.silhouette?.[16]||[0,0], ann.silhouette?.[152]||[0,0]); const rel=Math.abs(leftW-rightW)/Math.max(1,Math.max(leftW,rightW)); const m3=clamp(1-rel/0.3,0,1)*100; return [Math.round(m1),Math.round(m2),Math.round(m3)]; }catch(e){return [50,50,50];} }
function chin_methods_ann(ann,box){ try{ const chin=ann.silhouette?.[152]||[0,0]; const left=ann.silhouette?.[0]||[box.x+box.width*0.12,box.y+box.height]; const right=ann.silhouette?.[16]||[box.x+box.width*0.88,box.y+box.height]; const mid=[(left[0]+right[0])/2,(left[1]+right[1])/2]; const m1=clamp(dist(chin,mid)/Math.max(1,box.height)/0.25,0,1)*100; const mouthY=mean((ann.lipsUpperInner||[]).map(p=>p[1]))||0; const m2=clamp((chin[1]-mouthY)/Math.max(1,box.height)/0.18,0,1)*100; const m3=clamp((m1+m2)/2,0,1)*100; return [Math.round(m1),Math.round(m2),Math.round(m3)]; }catch(e){return [50,50,50];} }
function ratio_methods_ann(ann,box){ try{ const chinY=ann.silhouette?.[152]?.[1]||(box.y+box.height); const browY=ann.leftEyebrowUpper?.[2]?.[1]||(box.y); const faceH=Math.max(1,Math.abs(chinY-browY)); const faceW=box.width||1; const r=faceW/faceH; const m1=clamp(1-Math.abs(r-0.8)/0.5,0,1)*100; const noseY=ann.noseTip?.[0]?.[1]||(browY+faceH*0.45); const a=(noseY-browY), b2=(chinY-noseY); const total=faceH||1; const thirds=[a/total||0,b2/total||0,0]; const dev=mean(thirds.map(t=>Math.abs(t-1/3))); const m2=clamp(1-dev*3,0,1)*100; const m3=clamp(1-Math.abs(faceW/faceH-0.8)/0.8,0,1)*100; return [Math.round(m1),Math.round(m2),Math.round(m3)]; }catch(e){return [50,50,50];} }

/* OVERALL weights */
const OVERALL_WEIGHTS = { jawline:0.18, cheekbones:0.12, faceShape:0.12, eyes:0.10, symmetry:0.15, skin:0.08, proportions:0.08, chin:0.07, ratio:0.10 };
function computeOverall(scores){ let sum=0, tot=0; for(const k in OVERALL_WEIGHTS){ sum += (scores[k]||0) * OVERALL_WEIGHTS[k]; tot += OVERALL_WEIGHTS[k]; } return Math.round(sum / tot); }

/* ---------- Suggestion phrases + predicates ----------
   For each of the 10 categories we prepare up to 10 natural suggestions.
   Each suggestion has:
     - text: natural polish suggestion
     - predicate: function(ann, box, ctx, scores) => boolean meaning "confirmed issue exists"
   If predicate false => we re-evaluate the underlying metric once and check again.
   If still false => suggestion is discarded.
*/

/* Utilities for suggestion predicates */
function low(v, threshold){ return v < threshold; }
function high(v, threshold){ return v > threshold; }

/* Build suggestion templates per category */
function buildSuggestionCandidates(ann, box, ctx, scaledBox, scores){
  // scores: mapping key->value (0-100)
  const c = {}; // category => array of {text, predicate}
  // 1) jawline
  c.jawline = [
    { text: 'Linia ≈ºuchwy mog≈Çaby byƒá ostrzejsza ‚Äî spr√≥buj profilowego zdjƒôcia pod lepszym ≈õwiat≈Çem.', predicate: ()=> scores.jawline < 55 },
    { text: 'Asymetria w linii ≈ºuchwy jest zauwa≈ºalna ‚Äî rozwa≈º ustawienie twarzy prosto wzglƒôdem aparatu.', predicate: ()=> scores.jawline < 45 },
    { text: 'Broda wydaje siƒô cofniƒôta ‚Äî popraw kƒÖt aparatu (lekko wy≈ºej) lub spr√≥buj profilowego ujƒôcia.', predicate: ()=> scores.chin < 45 },
    { text: 'Brak wyra≈∫nego konturu ≈ºuchwy ‚Äî lepsze o≈õwietlenie boczne mo≈ºe pom√≥c.', predicate: ()=> scores.jawline < 60 },
    { text: 'Linia szczƒôki widoczna, ale delikatna ‚Äî delikatny kontrast ≈õwiat≈Ça poprawi detal.', predicate: ()=> scores.jawline < 70 },
    { text: 'Mo≈ºesz spr√≥bowaƒá zdjƒôcia z bardziej napiƒôtƒÖ szyjƒÖ ‚Äî poprawi widoczno≈õƒá linii ≈ºuchwy.', predicate: ()=> scores.jawline < 65 },
    { text: 'Kontur ≈ºuchwy zas≈Çoniƒôty w≈Çosami lub odzie≈ºƒÖ ‚Äî upewnij siƒô, ≈ºe twarz jest ods≈Çoniƒôta.', predicate: ()=> scores.jawline < 55 },
    { text: 'Ustawienie g≈Çowy mo≈ºe powodowaƒá z≈Çe odczyty ‚Äî sprawd≈∫ zdjƒôcie frontalne i profilowe.', predicate: ()=> scores.jawline < 50 },
    { text: 'Mo≈ºliwe rozmycie zdjƒôcia ‚Äî u≈ºyj zdjƒôcia ostrego, bez ruchu.', predicate: ()=> scores.jawline < 40 },
    { text: 'S≈Çabe o≈õwietlenie od frontu ‚Äî popraw o≈õwietlenie, aby lepiej uwidoczniƒá kontury.', predicate: ()=> scores.jawline < 60 }
  ];

  // 2) faceShape
  c.faceShape = [
    { text: 'Kszta≈Çt twarzy jest mniej wyra≈∫ny ‚Äî spr√≥buj zdjƒôcia z neutralnym wyrazem i r√≥wnym o≈õwietleniem.', predicate: ()=> scores.faceShape < 60 },
    { text: 'G√≥ra twarzy i dolna czƒô≈õƒá majƒÖ podobnƒÖ szeroko≈õƒá ‚Äî to wp≈Çywa na klasyfikacjƒô typu.', predicate: ()=> scores.faceShape < 55 },
    { text: 'Mo≈ºe brakowaƒá kontrastu miƒôdzy ko≈õƒámi policzkowymi a szczƒôkƒÖ ‚Äî inne ≈õwiat≈Ço pomo≈ºe.', predicate: ()=> scores.faceShape < 60 },
    { text: 'Ujƒôcie mo≈ºe zniekszta≈Çcaƒá proporcje (kƒÖt kamery) ‚Äî spr√≥buj zdjƒôcia na wysoko≈õci oczu.', predicate: ()=> scores.faceShape < 50 },
    { text: 'Rozwa≈º profilowe zdjƒôcie do precyzyjnego rozpoznania kszta≈Çtu twarzy.', predicate: ()=> scores.faceShape < 55 },
    { text: 'Je≈õli nosisz okulary, mogƒÖ wp≈Çywaƒá na odczyt kszta≈Çtu twarzy ‚Äî spr√≥buj bez okular√≥w.', predicate: ()=> scores.faceShape < 50 },
    { text: 'Kszta≈Çt twarzy wyglƒÖda na zaokrƒÖglony ‚Äî zdjƒôcie z d≈Çu≈ºszƒÖ perspektywƒÖ (mniejszy zoom) mo≈ºe pom√≥c.', predicate: ()=> scores.faceShape < 60 },
    { text: 'W≈Çosy przy twarzy zakrywajƒÖ kontury ‚Äî odsu≈Ñ w≈Çosy by ods≈Çoniƒá boki twarzy.', predicate: ()=> scores.faceShape < 55 },
    { text: 'S≈Çabe topo (brak widoczno≈õci ko≈õci policzkowych) ‚Äî popraw o≈õwietlenie boczne.', predicate: ()=> scores.cheekbones < 55 },
    { text: 'Delikatny kƒÖt kamery mo≈ºe dawaƒá fa≈Çszywy odczyt ‚Äî u≈ºyj neutralnej perspektywy.', predicate: ()=> scores.faceShape < 50 }
  ];

  // 3) eyes
  c.eyes = [
    { text: 'Oczy wydajƒÖ siƒô mieƒá niskƒÖ otwarto≈õƒá ‚Äî zdjƒôcie z wiƒôkszym otwarciem oczu poprawi odczyt.', predicate: ()=> scores.eyes < 55 },
    { text: 'SƒÖ lekko blisko osadzone ‚Äî spr√≥buj zdjƒôcia frontalnego bez zmiany pozycji.', predicate: ()=> scores.eyes < 50 },
    { text: 'MogƒÖ byƒá czƒô≈õciowo przys≈Çoniƒôte (w≈Çosy/okulary) ‚Äî ods≈Ço≈Ñ oczy.', predicate: ()=> scores.eyes < 60 },
    { text: 'Hooded / monolid mo≈ºe wp≈Çywaƒá na ocenƒô ‚Äî zmiana kƒÖta ≈õwiat≈Ça mo≈ºe uwypukliƒá kszta≈Çt.', predicate: ()=> scores.eyes < 55 },
    { text: 'Ostry cie≈Ñ lub odblaski na oczach ‚Äî u≈ºyj miƒôkkiego ≈õwiat≈Ça, by uniknƒÖƒá odblask√≥w.', predicate: ()=> scores.eyes < 65 },
    { text: 'Zbyt du≈ºy dystans miƒôdzy oczami ‚Äî wp≈Çywa to na typ (wide-set).', predicate: ()=> scores.eyes < 45 },
    { text: 'Pogorszone ostro≈õƒá obrazu oczu ‚Äî wyra≈∫niejsze zdjƒôcie doprowadzi do lepszego wyniku.', predicate: ()=> scores.eyes < 50 },
    { text: 'Ekspresja twarzy (zmru≈ºenie) wp≈Çywa na ocenƒô ‚Äî spr√≥buj rozlu≈∫nionego wyrazu.', predicate: ()=> scores.eyes < 55 },
    { text: 'U≈ºyj neutralnego t≈Ça ‚Äî kontrast oczu do t≈Ça u≈Çatwia analizƒô.', predicate: ()=> scores.eyes < 60 },
    { text: 'Je≈õli nosisz makija≈º, zmienia on proporcje ‚Äî spr√≥buj wersji bez makija≈ºu.', predicate: ()=> scores.eyes < 60 }
  ];

  // 4) jawline (we already have) - but we included many above; skipping duplicate

  // 4) cheekbones
  c.cheekbones = [
    { text: 'Ko≈õci policzkowe s≈Çabo widoczne ‚Äî dobre boczne o≈õwietlenie pomo≈ºe.', predicate: ()=> scores.cheekbones < 55 },
    { text: 'Policzki wydajƒÖ siƒô p≈Çaskie ‚Äî inny kƒÖt kamery (lekko z boku) mo≈ºe pokazaƒá profil lepiej.', predicate: ()=> scores.cheekbones < 50 },
    { text: 'Mo≈ºe byƒá efekt rozmycia sk√≥ry ‚Äî sprawd≈∫ ostro≈õƒá zdjƒôcia.', predicate: ()=> scores.cheekbones < 45 },
    { text: 'Upewnij siƒô, ≈ºe twarz nie jest zbyt roz≈õwietlona od przodu ‚Äî utrudnia to widoczno≈õƒá ko≈õci policzkowych.', predicate: ()=> scores.cheekbones < 60 },
    { text: 'OdciƒÖgnij w≈Çosy z bok√≥w twarzy by ods≈Çoniƒá ko≈õci policzkowe.', predicate: ()=> scores.cheekbones < 60 },
    { text: 'Lekki profil pomo≈ºe wykazaƒá wyra≈∫niejsze ko≈õci policzkowe.', predicate: ()=> scores.cheekbones < 55 },
    { text: 'Je≈õli masz makija≈º konturujƒÖcy, postaw na naturalne ≈õwiat≈Ço dla rzetelnego odczytu.', predicate: ()=> scores.cheekbones < 60 },
    { text: 'Zbyt du≈ºe zacienienie mo≈ºe ukrywaƒá ko≈õci policzkowe ‚Äî u≈ºyj miƒôkkiego, r√≥wnomiernego ≈õwiat≈Ça.', predicate: ()=> scores.cheekbones < 55 },
    { text: 'Spr√≥buj zdjƒôcia bez filtrowania (filtry mogƒÖ zaburzaƒá odczyt).', predicate: ()=> scores.cheekbones < 50 },
    { text: 'Je≈õli u≈ºywasz telefonu, oddal go trochƒô (mniejszy efekt rybiego oka).', predicate: ()=> scores.cheekbones < 50 }
  ];

  // 5) symmetry
  c.symmetry = [
    { text: 'Twarz wykazuje niewielkƒÖ asymetriƒô ‚Äî upewnij siƒô, ≈ºe stoi/siƒô prosto.', predicate: ()=> scores.symmetry < 70 },
    { text: 'Jedna strona twarzy jest nieco wy≈ºej ‚Äî neutralna pozycja poprawi wynik.', predicate: ()=> scores.symmetry < 65 },
    { text: 'Asymetria mo≈ºe wynikaƒá z ekspresji ‚Äî zr√≥b zdjƒôcie o neutralnym wyrazie.', predicate: ()=> scores.symmetry < 65 },
    { text: 'Asymetria w ustawieniu g≈Çowy (obr√≥t) ‚Äî ustaw prostƒÖ pozycjƒô wzglƒôdem obiektywu.', predicate: ()=> scores.symmetry < 60 },
    { text: 'R√≥≈ºne o≈õwietlenie po bokach twarzy ‚Äî wyr√≥wnaj ≈õwiat≈Ço.', predicate: ()=> scores.symmetry < 60 },
    { text: 'Ma≈Çe asymetrie sƒÖ normalne; je≈õli chcesz, zr√≥b wiƒôcej zdjƒôƒá i por√≥wnaj.', predicate: ()=> scores.symmetry < 55 },
    { text: 'Unikaj skrƒôconej g≈Çowy ‚Äì mo≈ºe to dawaƒá fa≈Çszywy wynik.', predicate: ()=> scores.symmetry < 60 },
    { text: 'Sprawd≈∫, czy aparat by≈Ç r√≥wno ustawiony (poziom).', predicate: ()=> scores.symmetry < 60 },
    { text: 'Upewnij siƒô, ≈ºe nie ma obcinania jednej strony twarzy przez kadr.', predicate: ()=> scores.symmetry < 50 },
    { text: 'Je≈õli masz powa≈ºnƒÖ asymetriƒô, rozwa≈º dokumentacjƒô medycznƒÖ ‚Äî tutaj to tylko wskaz√≥wka.', predicate: ()=> scores.symmetry < 40 }
  ];

  // 6) skin
  c.skin = [
    { text: 'Sk√≥ra wykazuje teksturƒô ‚Äî popraw o≈õwietlenie i nawil≈ºenie.', predicate: ()=> scores.skin < 65 },
    { text: 'Widoczne plamki/za≈Çamania koloru ‚Äî u≈ºyj r√≥wnomiernego ≈õwiat≈Ça i ewentualnie korekty.', predicate: ()=> scores.skin < 60 },
    { text: 'Zdjƒôcie wykazuje ziarno ‚Äî lepsza jako≈õƒá aparatu/wiƒôksze ≈õwiat≈Ço poprawi wynik.', predicate: ()=> scores.skin < 55 },
    { text: 'Cienie i odbicia wp≈ÇywajƒÖ na odczyt ‚Äî miƒôkkie ≈õwiat≈Ço bƒôdzie lepsze.', predicate: ()=> scores.skin < 60 },
    { text: 'Sk√≥ra wyglƒÖda na przesuszonƒÖ ‚Äî nawil≈ºenie poprawi wyglƒÖd.', predicate: ()=> scores.skin < 60 },
    { text: 'Je≈õli masz makija≈º kryjƒÖcy, usu≈Ñ go dla rzetelniejszej oceny.', predicate: ()=> scores.skin < 55 },
    { text: 'U≈ºyj neutralnego t≈Ça ‚Äî kontrast t≈Ça wp≈Çywa na pr√≥bki sk√≥ry.', predicate: ()=> scores.skin < 60 },
    { text: 'Unikaj filtr√≥w obraz√≥w ‚Äî mogƒÖ sztucznie wyg≈Çadzaƒá sk√≥rƒô.', predicate: ()=> scores.skin < 60 },
    { text: 'Kilka plik√≥w z r√≥≈ºnym o≈õwietleniem pozwoli por√≥wnaƒá wyniki.', predicate: ()=> scores.skin < 55 },
    { text: 'Skoncentruj analizƒô na ≈õrodkowych partiach twarzy (czo≈Ço, policzki).', predicate: ()=> scores.skin < 50 }
  ];

  // 7) proportions
  c.proportions = [
    { text: 'Proporcje twarzy sƒÖ nieoptymalne wed≈Çug klasycznych regu≈Ç ‚Äî spr√≥buj neutralnego ujƒôcia.', predicate: ()=> scores.proportions < 65 },
    { text: 'Dolna czƒô≈õƒá twarzy mo≈ºe byƒá za wysoka/niska ‚Äî spr√≥buj zdjƒôcia frontalnego bez przekrƒôcania g≈Çowy.', predicate: ()=> scores.proportions < 60 },
    { text: 'Upewnij siƒô, ≈ºe nos i usta sƒÖ dobrze widoczne ‚Äî zas≈Çoniƒôcie zmienia proporcje.', predicate: ()=> scores.proportions < 60 },
    { text: 'R√≥≈ºne kƒÖty fotografowania wp≈ÇywajƒÖ na proporcje ‚Äî trzymaj aparat na wysoko≈õci oczu.', predicate: ()=> scores.proportions < 55 },
    { text: 'Naturalna mimika (bez u≈õmiechu) daje najrzetelniejsze proporcje.', predicate: ()=> scores.proportions < 60 },
    { text: 'Filtry mogƒÖ zmieniaƒá proporcje twarzy ‚Äî u≈ºyj surowego zdjƒôcia.', predicate: ()=> scores.proportions < 55 },
    { text: 'Je≈õli masz brodƒô, mo≈ºe ona zaburzaƒá proporcje ‚Äî spr√≥buj wersji bez lub z przystrzy≈ºonƒÖ brodƒÖ.', predicate: ()=> scores.proportions < 55 },
    { text: 'Utrzymaj neutralne wyciƒôcie kadru (nie obcinaj czo≈Ça ani podbr√≥dka).', predicate: ()=> scores.proportions < 55 },
    { text: 'Kilka ujƒôƒá z r√≥≈ºnymi kƒÖtami pomo≈ºe znale≈∫ƒá najlepsze proporcje.', predicate: ()=> scores.proportions < 50 },
    { text: 'Je≈õli nosisz okulary, spr√≥buj wersji bez nich ‚Äî mogƒÖ wp≈Çywaƒá na proporcje.', predicate: ()=> scores.proportions < 55 }
  ];

  // 8) chin
  c.chin = [
    { text: 'Broda mog≈Çaby byƒá bardziej wysuniƒôta ‚Äî profilowe ujƒôcie pomo≈ºe potwierdziƒá.', predicate: ()=> scores.chin < 55 },
    { text: 'Widoczno≈õƒá podbr√≥dka jest niska ‚Äî u≈ºyj zdjƒôcia z mniejszym zoomem.', predicate: ()=> scores.chin < 50 },
    { text: 'Cie≈Ñ pod brodƒÖ zniekszta≈Çca odczyt ‚Äî popraw o≈õwietlenie.', predicate: ()=> scores.chin < 55 },
    { text: 'Je≈õli masz w≈Çosy lub zarost przy brodzie ‚Äî odsu≈Ñ je by ods≈Çoniƒá kontur.', predicate: ()=> scores.chin < 60 },
    { text: 'Delikatne napiƒôcie szyi mo≈ºe poprawiƒá profil brody na zdjƒôciu.', predicate: ()=> scores.chin < 60 },
    { text: 'Upewnij siƒô, ≈ºe kadr nie obcina dolnej czƒô≈õci twarzy.', predicate: ()=> scores.chin < 50 },
    { text: 'Profilowe zdjƒôcie ujawnia projekcjƒô brody ‚Äî warto por√≥wnaƒá.', predicate: ()=> scores.chin < 55 },
    { text: 'Rozwa≈º zdjƒôcie przy s≈Çabym kontra≈õcie by uniknƒÖƒá ostrych cieni.', predicate: ()=> scores.chin < 55 },
    { text: 'Je≈õli masz "podw√≥jny podbr√≥dek" na zdjƒôciu, spr√≥buj innego kƒÖta.', predicate: ()=> scores.chin < 45 },
    { text: 'Zdjƒôcie powinno byƒá wyra≈∫ne (ostre) ‚Äî rozmycie zani≈ºa wynik.', predicate: ()=> scores.chin < 50 }
  ];

  // 9) ratio
  c.ratio = [
    { text: 'Stosunek szeroko≈õci do wysoko≈õci twarzy mo≈ºe byƒá poprawiony ‚Äî spr√≥buj zdjƒôcia frontalnego.', predicate: ()=> scores.ratio < 60 },
    { text: 'Zbyt szeroka/taka twarz mo≈ºe wp≈Çywaƒá na ocenƒô ‚Äî inny kƒÖt pomo≈ºe.', predicate: ()=> scores.ratio < 55 },
    { text: 'Upewnij siƒô, ≈ºe zdjƒôcie nie jest zbyt blisko (efekt rybiego oka).', predicate: ()=> scores.ratio < 55 },
    { text: 'D≈Çu≈ºsze ujƒôcie (mniejszy zoom) poprawi proporcje obrazu.', predicate: ()=> scores.ratio < 55 },
    { text: 'Sprawd≈∫, czy zdjƒôcie nie jest obciƒôte od g√≥ry lub do≈Çu ‚Äî to zniekszta≈Çca ratio.', predicate: ()=> scores.ratio < 50 },
    { text: 'Je≈ºeli chcesz, wykonaj zdjƒôcie w naturalnym ≈õwietle bez filtr√≥w.', predicate: ()=> scores.ratio < 55 },
    { text: 'Por√≥wnaj kilka zdjƒôƒá w r√≥≈ºnych proporcjach by znale≈∫ƒá najlepszƒÖ wersjƒô.', predicate: ()=> scores.ratio < 50 },
    { text: 'U≈ºyj neutralnego t≈Ça, by u≈Çatwiƒá odnalezienie krawƒôdzi twarzy.', predicate: ()=> scores.ratio < 60 },
    { text: 'Korekta kadrowania (zostaw czo≈Ço i podbr√≥dek) poprawi odczyt.', predicate: ()=> scores.ratio < 55 },
    { text: 'Nie u≈ºywaj panoramicznych kadr√≥w ‚Äî zaburzajƒÖ proporcje.', predicate: ()=> scores.ratio < 50 }
  ];

  // 10) overall (general suggestions)
  c.overall = [
    { text: 'Og√≥lnie: spr√≥buj wykonaƒá zdjƒôcie przy naturalnym, miƒôkkim ≈õwietle (np. rano).', predicate: ()=> (scores.overall||0) < 70 },
    { text: 'Og√≥lnie: postaraj siƒô o neutralny wyraz twarzy (bez szerokiego u≈õmiechu).', predicate: ()=> (scores.overall||0) < 75 },
    { text: 'Og√≥lnie: sprawd≈∫ zdjƒôcie bez filtr√≥w i bez mocnego makija≈ºu.', predicate: ()=> (scores.overall||0) < 75 },
    { text: 'Og√≥lnie: zr√≥b kilka zdjƒôƒá z r√≥≈ºnym o≈õwietleniem i wybierz najlepsze.', predicate: ()=> (scores.overall||0) < 80 },
    { text: 'Og√≥lnie: usu≈Ñ elementy zas≈ÇaniajƒÖce (okulary, w≈Çosy, maski).', predicate: ()=> (scores.overall||0) < 70 },
    { text: 'Og√≥lnie: kr√≥tszy zoom i kadr od klatki piersiowej w g√≥rƒô dzia≈Ça zwykle lepiej.', predicate: ()=> (scores.overall||0) < 75 },
    { text: 'Og√≥lnie: je≈õli chcesz, zachowaj raport JSON do por√≥wna≈Ñ w przysz≈Ço≈õci.', predicate: ()=> (scores.overall||0) < 100 },
    { text: 'Og√≥lnie: u≈ºyj neutralnego t≈Ça, unikaj silnych cieni.', predicate: ()=> (scores.overall||0) < 75 },
    { text: 'Og√≥lnie: dbaj o regularne nawil≈ºenie sk√≥ry ‚Äì to poprawia ocenƒô skin quality.', predicate: ()=> scores.skin < 70 },
    { text: 'Og√≥lnie: je≈õli chcesz precyzji medycznej, skonsultuj siƒô ze specjalistƒÖ.', predicate: ()=> (scores.overall||0) < 40 }
  ];

  return c;
}

/* function to verify candidate suggestions:
   - for each candidate: run predicate
   - if false: re-evaluate relevant metric(s) once and test again
   - keep confirmed ones
*/
async function verifySuggestions(ann, box, ctx, scaledBox, scores){
  rawSuggestionCandidates = buildSuggestionCandidates(ann,box,ctx,scaledBox,scores);
  improvementSuggestions = {}; // reset
  // For each category, test each candidate
  for(const cat of Object.keys(rawSuggestionCandidates)){
    improvementSuggestions[cat] = [];
    const arr = rawSuggestionCandidates[cat];
    for(const cand of arr){
      try{
        let ok = false;
        try{ ok = !!cand.predicate(); }catch(e){ ok=false; }
        if(!ok){
          // re-evaluate metric(s) related to category (call scoring functions again)
          // small sleep to ensure not blocking UI
          await new Promise(r=>setTimeout(r,120));
          // recompute relevant score(s)
          const recomputed = await recomputeCategory(cat, ann, box, ctx, scaledBox);
          // update scores mapping
          if(recomputed !== null){
            scores[cat] = recomputed;
          }
          // re-run predicate (some predicates use scores map)
          try{ ok = !!cand.predicate(); }catch(e){ ok=false; }
        }
        if(ok){
          improvementSuggestions[cat].push(cand.text);
        }
        // cap to 10 suggestions per category
        if(improvementSuggestions[cat].length >= 10) break;
      }catch(e){
        console.warn('candidate verify error', e);
      }
    }
  }
  return improvementSuggestions;
}

/* recomputeCategory performs a focused recompute of a category and returns numeric value or null */
async function recomputeCategory(cat, ann, box, ctx, scaledBox){
  try{
    switch(cat){
      case 'jawline': return jaw_score(ann,box);
      case 'faceShape': return faceShape_score(ann,box);
      case 'eyes': return Math.round(mean([eyes_mA(ann,box), eyes_mB(ann,box), eyes_mC(ann,box)]));
      case 'cheekbones': return cheek_score(ann,box);
      case 'symmetry': return sym_score(ann,box);
      case 'skin': return skin_score(ctx, scaledBox);
      case 'proportions': return Math.round(mean(proportions_methods_ann(ann,box)));
      case 'chin': return Math.round(mean(chin_methods_ann(ann,box)));
      case 'ratio': return Math.round(mean(ratio_methods_ann(ann,box)));
      case 'overall': {
        // recompute all and overall
        const recomputedScores = {
          faceShape: faceShape_score(ann,box),
          jawline: jaw_score(ann,box),
          eyes: Math.round(mean([eyes_mA(ann,box), eyes_mB(ann,box), eyes_mC(ann,box)])),
          cheekbones: cheek_score(ann,box),
          symmetry: sym_score(ann,box),
          skin: skin_score(ctx, scaledBox),
          proportions: Math.round(mean(proportions_methods_ann(ann,box))),
          chin: Math.round(mean(chin_methods_ann(ann,box))),
          ratio: Math.round(mean(ratio_methods_ann(ann,box)))
        };
        return computeOverall(recomputedScores);
      }
      default: return null;
    }
  }catch(e){ console.warn('recompute error', e); return null; }
}

/* ---------- Main analyze flow (BlazeFace-first detection) ---------- */
async function analyzeFile(file){
  resultsGrid.innerHTML = '';
  savedNotice.textContent = '';
  analysisResults = null;
  improvementSuggestions = {};
  rawSuggestionCandidates = {};

  if(!file || !file.type.startsWith('image/')){ statusEl.textContent = 'Wybierz plik obrazkowy.'; return; }
  statusEl.textContent = 'Przygotowanie obrazu...';
  previewImg.src = URL.createObjectURL(file);
  previewImg.style.display = 'block';
  hint.style.display = 'none';
  uploadLabel.style.display = 'none';
  fileInput.style.display = 'none';
  changeBtn.style.display = 'inline-block';

  // load image
  const img = await new Promise((res, rej)=>{
    const I = new Image(); I.crossOrigin='anonymous';
    I.onload = ()=> res(I); I.onerror = rej; I.src = previewImg.src;
  }).catch(e=>{ statusEl.textContent = 'B≈ÇƒÖd ≈Çadowania obrazu.'; throw e; });

  // scaled canvas for skin sampling
  const MAX = 1200;
  let iw = img.width, ih = img.height;
  const scale = Math.max(1, Math.max(iw, ih)/MAX);
  const cw = Math.round(iw/scale), ch = Math.round(ih/scale);
  const canvas = document.createElement('canvas'); canvas.width = cw; canvas.height = ch;
  const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, cw, ch);

  let detectedBox = null;
  // 1) BlazeFace detection (must detect)
  if(ONLINE && blazefaceModel){
    statusEl.textContent = 'Wykrywanie twarzy (BlazeFace)...';
    try{
      const preds = await blazefaceModel.estimateFaces(img, false);
      if(preds && preds.length){
        const p = preds[0];
        const tl = Array.isArray(p.topLeft) ? p.topLeft : (p.topLeft?.arraySync ? p.topLeft.arraySync() : [0,0]);
        const br = Array.isArray(p.bottomRight) ? p.bottomRight : (p.bottomRight?.arraySync ? p.bottomRight.arraySync() : [0,0]);
        const sx = tl[0] * (cw / img.width), sy = tl[1] * (ch / img.height);
        const sw = Math.max(6, (br[0] - tl[0]) * (cw / img.width)), sh = Math.max(6, (br[1] - tl[1]) * (ch / img.height));
        detectedBox = { x: sx, y: sy, width: sw, height: sh };
      } else {
        statusEl.textContent = 'Nie wykryto twarzy ‚Äî spr√≥buj przes≈Çaƒá frontalne zdjƒôcie.';
        uploadLabel.style.display = 'inline-block';
        fileInput.style.display = 'inline-block';
        changeBtn.style.display = 'none';
        previewImg.style.display = 'block';
        return; // STOP: no face
      }
    }catch(e){
      console.warn('BlazeFace error', e);
      statusEl.textContent = 'B≈ÇƒÖd wykrywania twarzy ‚Äî spr√≥buj ponownie.';
      uploadLabel.style.display = 'inline-block';
      fileInput.style.display = 'inline-block';
      changeBtn.style.display = 'none';
      return;
    }
  } else {
    // offline heuristic detection
    statusEl.textContent = 'Wykrywanie twarzy (heurystyka)...';
    try{
      let minX=cw, minY=ch, maxX=0, maxY=0, count=0;
      const data = ctx.getImageData(0,0,cw,ch).data;
      for(let y=0;y<ch;y+=2){
        for(let x=0;x<cw;x+=2){
          const i = (y*cw + x)*4; const r=data[i], g=data[i+1], b=data[i+2];
          const cond = (r>95 && g>40 && b>20 && r>g && r>b && (r-g)>15);
          if(cond){ count++; if(x<minX)minX=x; if(y<minY)minY=y; if(x>maxX)maxX=x; if(y>maxY)maxY=y; }
        }
      }
      if(count > 50) detectedBox = { x:minX, y:minY, width: Math.max(6, maxX-minX), height: Math.max(6, maxY-minY) };
      else { statusEl.textContent = 'Nie wykryto twarzy (heurystyka).'; uploadLabel.style.display='inline-block'; fileInput.style.display='inline-block'; changeBtn.style.display='none'; return; }
    }catch(e){ statusEl.textContent='B≈ÇƒÖd detekcji'; uploadLabel.style.display='inline-block'; fileInput.style.display='inline-block'; changeBtn.style.display='none'; return; }
  }

  // 2) FaceMesh for landmarks
  let ann = null, box = null;
  if(ONLINE && meshModel){
    statusEl.textContent = 'Wykrywanie punkt√≥w (FaceMesh)...';
    try{
      const preds = await meshModel.estimateFaces({ input: img, returnTensors:false, predictIrises:false });
      if(preds && preds.length){
        const p = preds[0];
        ann = p.annotations || p;
        ann.scaledMesh = p.scaledMesh || p;
        if(p.boundingBox && p.boundingBox.topLeft && p.boundingBox.bottomRight){
          const tl = p.boundingBox.topLeft, br = p.boundingBox.bottomRight;
          box = { x: tl[0] * (cw / img.width), y: tl[1] * (ch / img.height), width: (br[0]-tl[0]) * (cw / img.width), height: (br[1]-tl[1]) * (ch / img.height) };
        } else {
          box = detectedBox || meshBox(ann.scaledMesh || ann) || detectedBox;
        }
      } else {
        ann = null;
        box = detectedBox;
      }
    }catch(e){
      console.warn('FaceMesh error', e);
      ann = null;
      box = detectedBox;
    }
  } else {
    ann = null;
    box = detectedBox;
  }

  const scaledBox = { x: box.x || 0, y: box.y || 0, width: box.width || cw, height: box.height || ch };

  try{
    // compute scores
    const scores = {};
    scores.faceShape = faceShape_score(ann||{}, {x:box.x||0,y:box.y||0,width:box.width||cw,height:box.height||ch});
    scores.jawline = jaw_score(ann||{}, {x:box.x||0,y:box.y||0,width:box.width||cw,height:box.height||ch});
    scores.eyes = Math.round(mean([eyes_mA(ann||{},box||{}), eyes_mB(ann||{},box||{}), eyes_mC(ann||{},box||{})]));
    const eyeType = mapEyeType(ann||{}, box||{});
    scores.cheekbones = cheek_score(ann||{}, {x:box.x||0,y:box.y||0,width:box.width||cw,height:box.height||ch});
    scores.symmetry = sym_score(ann||{}, {x:box.x||0,y:box.y||0,width:box.width||cw,height:box.height||ch});
    scores.skin = skin_score(ctx, scaledBox);
    scores.proportions = Math.round(mean(proportions_methods_ann(ann||{}, {x:box.x||0,y:box.y||0,width:box.width||cw,height:box.height||ch})));
    scores.chin = Math.round(mean(chin_methods_ann(ann||{}, {x:box.x||0,y:box.y||0,width:box.width||cw,height:box.height||ch})));
    scores.ratio = Math.round(mean(ratio_methods_ann(ann||{}, {x:box.x||0,y:box.y||0,width:box.width||cw,height:box.height||ch})));
    const overall = computeOverall(scores);
    scores.overall = overall;

    // store results for export
    analysisResults = {
      timestamp: new Date().toISOString(),
      scores,
      eyeType,
      faceShape: detectFaceShape(ann||{}, {x:box.x||0,y:box.y||0,width:box.width||cw,height:box.height||ch})
    };

    // generate candidate suggestions and then verify them (with re-evaluation if needed)
    statusEl.textContent = 'Generujƒô sugestie i weryfikujƒô je...';
    const verified = await verifySuggestions(ann||{}, {x:box.x||0,y:box.y||0,width:box.width||cw,height:box.height||ch}, ctx, scaledBox, scores);

    // render results + suggestions
    resultsGrid.innerHTML = '';
    const order = [
      {k:'faceShape', label:`Face Shape: ${analysisResults.faceShape}`, val:scores.faceShape},
      {k:'eyes', label:`Eyes: ${analysisResults.eyeType}`, val:scores.eyes},
      {k:'jawline', label:'Jawline', val:scores.jawline},
      {k:'cheekbones', label:'Cheekbones', val:scores.cheekbones},
      {k:'symmetry', label:'Symmetry', val:scores.symmetry},
      {k:'skin', label:'Sk√≥ra', val:scores.skin},
      {k:'proportions', label:'Proportions', val:scores.proportions},
      {k:'chin', label:'Chin Ratio', val:scores.chin},
      {k:'ratio', label:'Face Ratio', val:scores.ratio},
      {k:'overall', label:'Overall', val:scores.overall}
    ];

    // create nodes and attach suggestion bubbles
    const nodes = order.map(it=>{
      const { row, ring, v, text, labelEl } = createRow(it.label, '');
      resultsGrid.appendChild(row);
      // suggestions list
      const sugContainer = document.createElement('div'); sugContainer.className = 'suggestions';
      const catList = verified[it.k] || [];
      if(catList.length === 0){
        // show a neutral hint
        const p = document.createElement('div'); p.className='suggestion-item'; p.textContent = 'Brak istotnych sugestii ‚Äî wszystko OK.';
        sugContainer.appendChild(p);
      } else {
        catList.slice(0,10).forEach(sg=>{
          const p = document.createElement('div'); p.className='suggestion-item'; p.textContent = '‚Ä¢ ' + sg;
          sugContainer.appendChild(p);
        });
      }
      row.appendChild(sugContainer);
      return { ring, value: it.val };
    });

    // animate sequentially
    for(let i=0;i<nodes.length;i++){
      await new Promise(r=>setTimeout(r, i===0?120:260));
      await animateRing(nodes[i].ring, nodes[i].value);
    }

    statusEl.textContent = 'Analiza zako≈Ñczona ‚úÖ';
    modeNote.textContent = ONLINE ? 'Tryb: ONLINE (BlazeFace + FaceMesh)' : 'Tryb: OFFLINE (heurystyki)';
    footerMsg.textContent = `FaceShapes: ${FACE_SHAPES.join(', ')} ‚Ä¢ EyeTypes: ${EYE_TYPES.join(', ')}`;

    // keep analysisResults and improvementSuggestions for export
    improvementSuggestions = verified;
    analysisResults.raw = { detectedBox, faceBox: box };
    analysisResults.imageSize = { width: img.width, height: img.height };

  }catch(err){
    console.error('Scoring error', err);
    statusEl.textContent = 'B≈ÇƒÖd podczas analizy: ' + (err.message || err);
  }
}

/* ---------- Events ---------- */
uploadLabel.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', async (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f){ statusEl.textContent = 'Nie wybrano pliku.'; return; }
  if(!READY){
    statusEl.textContent = 'Modele siƒô ≈ÇadujƒÖ ‚Äî proszƒô chwilƒô poczekaƒá...';
    const waitUntil = Date.now() + 7000;
    while(!READY && Date.now() < waitUntil) await new Promise(r=>setTimeout(r,200));
  }
  try{
    statusEl.textContent = 'Rozpoczynam analizƒô...';
    await analyzeFile(f);
  }catch(e){
    console.error(e);
    statusEl.textContent = 'B≈ÇƒÖd: ' + (e.message || e);
  }
});

changeBtn.addEventListener('click', ()=>{
  previewImg.src=''; previewImg.style.display='none';
  hint.style.display='block';
  fileInput.value=''; fileInput.style.display='inline-block';
  uploadLabel.style.display='inline-block';
  changeBtn.style.display='none';
  resultsGrid.innerHTML=''; statusEl.textContent='Wybierz zdjƒôcie.';
  savedNotice.textContent='';
});

/* ---------- Save report (JSON / TXT) ---------- */
saveReportBtn.addEventListener('click', ()=>{
  if(!analysisResults){ savedNotice.style.color='orange'; savedNotice.textContent='Brak wynik√≥w ‚Äî najpierw przeprowad≈∫ analizƒô.'; return; }
  const data = {
    timestamp: analysisResults.timestamp,
    imageSize: analysisResults.imageSize,
    scores: analysisResults.scores || analysisResults.scores,
    faceShape: analysisResults.faceShape,
    eyeType: analysisResults.eyeType,
    suggestions: improvementSuggestions,
    raw: analysisResults.raw || {}
  };

  const choice = confirm('Zapisz jako JSON? (OK = JSON, Anuluj = czytelny TXT)');
  if(choice){
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `face_report_${Date.now()}.json`;
    link.click();
    savedNotice.style.color='lightgreen';
    savedNotice.textContent = 'Raport JSON wygenerowany. Plik pobrany.';
  } else {
    let text = 'üî• Raport Face Analyzer üî•\n\n';
    text += `Data: ${new Date(analysisResults.timestamp).toLocaleString()}\n\n`;
    const sc = analysisResults.scores || analysisResults.scores;
    for(const k of ['faceShape','eyeType','jawline','cheekbones','symmetry','skin','proportions','chin','ratio','overall']){
      if(k === 'faceShape') text += `Face Shape: ${analysisResults.faceShape}\n`;
      else if(k === 'eyeType') text += `Eyes: ${analysisResults.eyeType}\n`;
      else text += `${k}: ${sc[k] ?? (analysisResults.scores && analysisResults.scores[k]) ?? '‚Äî'}\n`;
    }
    text += '\nSugestie:\n';
    for(const cat of Object.keys(improvementSuggestions)){
      const arr = improvementSuggestions[cat];
      if(!arr || !arr.length) continue;
      text += `\n${cat.toUpperCase()}:\n`;
      arr.forEach((s,idx)=> text += `  ${idx+1}. ${s}\n`);
    }
    const blob = new Blob([text], { type: 'text/plain' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `face_report_${Date.now()}.txt`;
    link.click();
    savedNotice.style.color='lightgreen';
    savedNotice.textContent = 'Raport TXT wygenerowany. Plik pobrany.';
  }
});

/* End of script */
</script>
</body>
</html>





<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Osobowo≈õci</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; }
  #quiz-container { margin-bottom: 20px; }
  .question { font-weight: bold; margin-bottom: 10px; }
  .options button { display: block; margin: 5px 0; padding: 10px; width: 100%; }
  #results { display: none; }
  #overallDesc { margin-top: 20px; font-weight: bold; font-size: 1.2em; }
</style>
</head>
<body>

<h1>Quiz Osobowo≈õci</h1>
<div id="quiz-container">
  <div id="question-text" class="question"></div>
  <div class="options" id="options-container"></div>
</div>

<div id="results">
  <h2>Twoje wyniki</h2>
  <canvas id="resultsChart" width="700" height="400"></canvas>
  <div id="overallDesc"></div>
</div>

<script>
const quizData = [
  // --------------------
  // 1. SPOS√ìB MY≈öLENIA - 10 pyta≈Ñ
  {category:'Spos√≥b my≈õlenia', question:'Jak reagujesz w stresie?', options:[
    {text:'Zamykam siƒô w sobie', points:0},
    {text:'Pr√≥bujƒô zrozumieƒá emocje', points:3},
    {text:'Staram siƒô wp≈ÇynƒÖƒá na sytuacjƒô', points:8},
    {text:'Analizujƒô i planujƒô logicznie', points:10}
  ]},
  {category:'Spos√≥b my≈õlenia', question:'Jak rozwiƒÖzujesz problemy?', options:[
    {text:'Nie radzƒô sobie', points:0},
    {text:'Pr√≥bujƒô intuicyjnie', points:3},
    {text:'Stosujƒô r√≥≈ºne strategie', points:8},
    {text:'U≈ºywam analizy i logiki', points:10}
  ]},
  {category:'Spos√≥b my≈õlenia', question:'Jak reagujesz na konflikty?', options:[
    {text:'Unikam', points:0},
    {text:'Czasem ulegam emocjom', points:3},
    {text:'Pr√≥bujƒô rozwiƒÖzaƒá', points:8},
    {text:'Analizujƒô i planujƒô strategiƒô', points:10}
  ]},
  {category:'Spos√≥b my≈õlenia', question:'Jak radzisz sobie ze stresem?', options:[
    {text:'≈πle', points:0},
    {text:'≈örednio', points:3},
    {text:'Dobrze', points:8},
    {text:'Perfekcyjnie', points:10}
  ]},
  {category:'Spos√≥b my≈õlenia', question:'Jak podejmujesz decyzje?', options:[
    {text:'Emocjonalnie', points:0},
    {text:'Czƒô≈õciowo logicznie', points:3},
    {text:'Przewa≈ºnie logicznie', points:8},
    {text:'Zawsze logicznie i przemy≈õlanie', points:10}
  ]},
  {category:'Spos√≥b my≈õlenia', question:'Czy planujesz przysz≈Ço≈õƒá?', options:[
    {text:'Nie', points:0},
    {text:'Czasami', points:3},
    {text:'Przewa≈ºnie', points:8},
    {text:'Zawsze szczeg√≥≈Çowo', points:10}
  ]},
  {category:'Spos√≥b my≈õlenia', question:'Czy pr√≥bujesz czasem wp≈ÇynƒÖƒá na innych?', options:[
    {text:'Nigdy', points:0},
    {text:'Rzadko', points:3},
    {text:'Czƒôsto', points:8},
    {text:'Zawsze przemy≈õlanie', points:10}
  ]},
  {category:'Spos√≥b my≈õlenia', question:'Jak analizujesz sytuacje?', options:[
    {text:'Nie analizujƒô', points:0},
    {text:'Czasami', points:3},
    {text:'Przewa≈ºnie', points:8},
    {text:'Zawsze dok≈Çadnie', points:10}
  ]},
  {category:'Spos√≥b my≈õlenia', question:'Czy wykorzystujesz okazje by osiƒÖgnƒÖƒá cele?', options:[
    {text:'Nigdy', points:0},
    {text:'Czasem', points:3},
    {text:'Czƒôsto', points:8},
    {text:'Zawsze przemy≈õlanie', points:10}
  ]},
  {category:'Spos√≥b my≈õlenia', question:'Jak szybko uczysz siƒô nowych rzeczy?', options:[
    {text:'Bardzo wolno', points:0},
    {text:'Wolno', points:3},
    {text:'Szybko', points:8},
    {text:'Bardzo szybko i efektywnie', points:10}
  ]},

  // --------------------
  // 2. SI≈ÅA - 10 pyta≈Ñ
  {category:'Si≈Ça', question:'Ile robisz pompek?', options:[
    {text:'0', points:1.0},
    {text:'10', points:3.2},
    {text:'50 lub skomplikowane', points:6.4},
    {text:'Serie jednorƒôczne', points:10.0}
  ]},
  {category:'Si≈Ça', question:'Ile serii robisz na si≈Çowni?', options:[
    {text:'0', points:1.0},
    {text:'10', points:3.2},
    {text:'50 lub skomplikowane', points:6.4},
    {text:'Serie jednorƒôczne', points:10.0}
  ]},
  {category:'Si≈Ça', question:'Ile podciƒÖgniƒôƒá robisz?', options:[
    {text:'0', points:1.0},
    {text:'10', points:3.2},
    {text:'50 lub trudne', points:6.4},
    {text:'Serie ekstremalne', points:10.0}
  ]},
  {category:'Si≈Ça', question:'Ile przysiad√≥w robisz?', options:[
    {text:'0', points:1.0},
    {text:'10', points:3.2},
    {text:'50', points:6.4},
    {text:'100+', points:10.0}
  ]},
  {category:'Si≈Ça', question:'Ile kilometr√≥w biegniesz?', options:[
    {text:'0', points:1.0},
    {text:'2', points:3.2},
    {text:'10', points:6.4},
    {text:'20+', points:10.0}
  ]},
  {category:'Si≈Ça', question:'Ile plank√≥w robisz?', options:[
    {text:'0', points:1.0},
    {text:'10', points:3.2},
    {text:'50', points:6.4},
    {text:'100+', points:10.0}
  ]},
  {category:'Si≈Ça', question:'Ile kg podnosisz w martwym ciƒÖgu?', options:[
    {text:'0', points:1.0},
    {text:'10', points:3.2},
    {text:'50', points:6.4},
    {text:'100+', points:10.0}
  ]},
  {category:'Si≈Ça', question:'Ile pompek w serii?', options:[
    {text:'0', points:1.0},
    {text:'10', points:3.2},
    {text:'50', points:6.4},
    {text:'Serie jednorƒôczne', points:10.0}
  ]},
  {category:'Si≈Ça', question:'Ile przysiad√≥w z ciƒô≈ºarem?', options:[
    {text:'0', points:1.0},
    {text:'10', points:3.2},
    {text:'50', points:6.4},
    {text:'100+', points:10.0}
  ]},
  {category:'Si≈Ça', question:'Ile serii podciƒÖgniƒôƒá robisz?', options:[
    {text:'0', points:1.0},
    {text:'10', points:3.2},
    {text:'50', points:6.4},
    {text:'Serie ekstremalne', points:10.0}
  ]},

  // --------------------
  // 3. WIARA - 10 pyta≈Ñ
  {category:'Wiara', question:'Jaki jest Tw√≥j ≈õwiatopoglƒÖd?', options:[
    {text:'Chrze≈õcija≈Ñstwo', points:4},
    {text:'Inne', points:5},
    {text:'Ateizm', points:6},
    {text:'Satanizm', points:10}
  ]},
  {category:'Wiara', question:'Czy praktykujesz religiƒô codziennie?', options:[
    {text:'Nie', points:4},
    {text:'Czasami', points:5},
    {text:'Rzadko', points:6},
    {text:'Zawsze', points:10}
  ]},
  {category:'Wiara', question:'Czy ufasz swoim wierzeniom?', options:[
    {text:'Nie', points:4},
    {text:'Trochƒô', points:5},
    {text:'≈örednio', points:6},
    {text:'Ca≈Çkowicie', points:10}
  ]},
  {category:'Wiara', question:'Czy modlisz siƒô?', options:[
    {text:'Nie', points:4},
    {text:'Czasem', points:5},
    {text:'Czƒôsto', points:6},
    {text:'Zawsze', points:10}
  ]},
  {category:'Wiara', question:'Czy czytasz literaturƒô religijnƒÖ?', options:[
    {text:'Nie', points:4},
    {text:'Czasem', points:5},
    {text:'Czƒôsto', points:6},
    {text:'Zawsze', points:10}
  ]},
  {category:'Wiara', question:'Czy uczestniczysz w obrzƒôdach?', options:[
    {text:'Nie', points:4},
    {text:'Rzadko', points:5},
    {text:'Czƒôsto', points:6},
    {text:'Zawsze', points:10}
  ]},
  {category:'Wiara', question:'Czy dyskutujesz o wierzeniach?', options:[
    {text:'Nie', points:4},
    {text:'Czasem', points:5},
    {text:'Czƒôsto', points:6},
    {text:'Zawsze', points:10}
  ]},
  {category:'Wiara', question:'Czy wierzysz w ≈ºycie pozagrobowe?', options:[
    {text:'Nie', points:4},
    {text:'Trochƒô', points:5},
    {text:'≈örednio', points:6},
    {text:'Ca≈Çkowicie', points:10}
  ]},
  {category:'Wiara', question:'Czy kierujesz siƒô wiarƒÖ w decyzjach?', options:[
    {text:'Nie', points:4},
    {text:'Czasami', points:5},
    {text:'Czƒôsto', points:6},
    {text:'Zawsze', points:10}
  ]},
  {category:'Wiara', question:'Czy modlisz siƒô w trudnych sytuacjach?', options:[
    {text:'Nie', points:4},
    {text:'Czasem', points:5},
    {text:'Czƒôsto', points:6},
    {text:'Zawsze', points:10}
  ]},

  // --------------------
  // 4. PIENIƒÑDZE - 10 pyta≈Ñ
  {category:'PieniƒÖdze', question:'Ile zarabiasz miesiƒôcznie?', options:[
    {text:'1000$', points:1},
    {text:'2000$', points:2},
    {text:'10 000$', points:4},
    {text:'100 000$+', points:10}
  ]},
  {category:'PieniƒÖdze', question:'Ile oszczƒôdzasz?', options:[
    {text:'0$', points:1},
    {text:'100$', points:2},
    {text:'1000$', points:4},
    {text:'10 000$+', points:10}
  ]},
  {category:'PieniƒÖdze', question:'Czy inwestujesz pieniƒÖdze?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:2},
    {text:'Regularnie', points:4},
    {text:'Zawsze przemy≈õlanie', points:10}
  ]},
  {category:'PieniƒÖdze', question:'Czy planujesz bud≈ºet?', options:[
    {text:'Nie', points:1},
    {text:'Rzadko', points:2},
    {text:'Czƒôsto', points:4},
    {text:'Zawsze', points:10}
  ]},
  {category:'PieniƒÖdze', question:'Czy pomagasz finansowo innym?', options:[
    {text:'Nigdy', points:1},
    {text:'Czasem', points:2},
    {text:'Czƒôsto', points:4},
    {text:'Zawsze', points:10}
  ]},
  {category:'PieniƒÖdze', question:'Czy masz dodatkowe ≈∫r√≥d≈Ça dochodu?', options:[
    {text:'Nie', points:1},
    {text:'1', points:2},
    {text:'2-3', points:4},
    {text:'Wiƒôcej ni≈º 3', points:10}
  ]},
  {category:'PieniƒÖdze', question:'Czy jeste≈õ zadowolony z dochodu?', options:[
    {text:'Nie', points:1},
    {text:'Czƒô≈õciowo', points:2},
    {text:'≈örednio', points:4},
    {text:'Bardzo', points:10}
  ]},
  {category:'PieniƒÖdze', question:'Czy kupujesz luksusowe rzeczy?', options:[
    {text:'Nigdy', points:1},
    {text:'Czasem', points:2},
    {text:'Czƒôsto', points:4},
    {text:'Zawsze', points:10}
  ]},
  {category:'PieniƒÖdze', question:'Czy prowadzisz w≈ÇasnƒÖ firmƒô?', options:[
    {text:'Nie', points:1},
    {text:'Tak, ma≈ÇƒÖ', points:2},
    {text:'≈öredniƒÖ', points:4},
    {text:'Du≈ºƒÖ', points:10}
  ]},
  {category:'PieniƒÖdze', question:'Czy inwestujesz w nieruchomo≈õci?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:2},
    {text:'Regularnie', points:4},
    {text:'Zawsze', points:10}
  ]},

  // --------------------
  // 5. POETYCYZM - 10 pyta≈Ñ
  {category:'Poetycyzm', question:'Jak dobrze piszesz wiersze?', options:[
    {text:'Fatalnie', points:1},
    {text:'Przeciƒôtnie', points:2},
    {text:'Ponadprzeciƒôtnie', points:4},
    {text:'Perfekcja', points:5}
  ]},
  {category:'Poetycyzm', question:'Jak dobrze piszesz powie≈õci?', options:[
    {text:'Fatalnie', points:1},
    {text:'Przeciƒôtnie', points:2},
    {text:'Ponadprzeciƒôtnie', points:4},
    {text:'Perfekcja', points:5}
  ]},
  {category:'Poetycyzm', question:'W ilu % rzeczy literackich siƒô odnajdujesz?', options:[
    {text:'0-5%', points:1},
    {text:'5-10%', points:2},
    {text:'10-50%', points:4},
    {text:'Idealnie', points:5}
  ]},
  {category:'Poetycyzm', question:'Czy inspirujesz siƒô literaturƒÖ?', options:[
    {text:'Nie', points:1},
    {text:'Trochƒô', points:2},
    {text:'Czƒôsto', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
  {category:'Poetycyzm', question:'Czy piszesz na codzie≈Ñ?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:2},
    {text:'Czƒôsto', points:4},
    {text:'Codziennie', points:5}
  ]},
  {category:'Poetycyzm', question:'Czy poprawiasz swoje teksty?', options:[
    {text:'Nigdy', points:1},
    {text:'Czasem', points:2},
    {text:'Czƒôsto', points:4},
    {text:'Zawsze', points:5}
  ]},
  {category:'Poetycyzm', question:'Czy publikujesz swoje teksty?', options:[
    {text:'Nigdy', points:1},
    {text:'Czasem', points:2},
    {text:'Czƒôsto', points:4},
    {text:'Zawsze', points:5}
  ]},
  {category:'Poetycyzm', question:'Czy potrafisz interpretowaƒá poezjƒô?', options:[
    {text:'Nie', points:1},
    {text:'Trochƒô', points:2},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
  {category:'Poetycyzm', question:'Czy tworzysz w≈Çasne style?', options:[
    {text:'Nie', points:1},
    {text:'Trochƒô', points:2},
    {text:'Czƒôsto', points:4},
    {text:'Zawsze', points:5}
  ]},
  {category:'Poetycyzm', question:'Czy potrafisz analizowaƒá literaturƒô?', options:[
    {text:'Nie', points:1},
    {text:'Trochƒô', points:2},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},

  // --------------------
  // 6. JƒòZYKOWO≈öƒÜ - 10 pyta≈Ñ
  {category:'Jƒôzykowo≈õƒá', question:'Ile znasz jƒôzyk√≥w (B2+)?', options:[
    {text:'0-1', points:5},
    {text:'2', points:6},
    {text:'3-4', points:8},
    {text:'>4', points:10}
  ]},
  {category:'Jƒôzykowo≈õƒá', question:'Na jakim poziomie znasz angielski?', options:[
    {text:'A1 lub mniej', points:5},
    {text:'A2', points:6},
    {text:'B2', points:8},
    {text:'C2 lub native', points:10}
  ]},
  {category:'Jƒôzykowo≈õƒá', question:'Czy uczysz siƒô jƒôzyk√≥w regularnie?', options:[
    {text:'Nie', points:5},
    {text:'Czasem', points:6},
    {text:'Regularnie', points:8},
    {text:'Codziennie', points:10}
  ]},
  {category:'Jƒôzykowo≈õƒá', question:'Czy rozumiesz teksty literackie?', options:[
    {text:'Nie', points:5},
    {text:'Trochƒô', points:6},
    {text:'Dobrze', points:8},
    {text:'Perfekcyjnie', points:10}
  ]},
  {category:'Jƒôzykowo≈õƒá', question:'Czy potrafisz t≈Çumaczyƒá teksty?', options:[
    {text:'Nie', points:5},
    {text:'Trochƒô', points:6},
    {text:'Dobrze', points:8},
    {text:'Perfekcyjnie', points:10}
  ]},
  {category:'Jƒôzykowo≈õƒá', question:'Czy potrafisz konwersowaƒá w obcym jƒôzyku?', options:[
    {text:'Nie', points:5},
    {text:'Czasem', points:6},
    {text:'Dobrze', points:8},
    {text:'Perfekcyjnie', points:10}
  ]},
  {category:'Jƒôzykowo≈õƒá', question:'Czy uczysz innych jƒôzyka?', options:[
    {text:'Nie', points:5},
    {text:'Czasem', points:6},
    {text:'Dobrze', points:8},
    {text:'Perfekcyjnie', points:10}
  ]},
  {category:'Jƒôzykowo≈õƒá', question:'Czy czytasz ksiƒÖ≈ºki w obcych jƒôzykach?', options:[
    {text:'Nie', points:5},
    {text:'Czasem', points:6},
    {text:'Dobrze', points:8},
    {text:'Perfekcyjnie', points:10}
  ]},
  {category:'Jƒôzykowo≈õƒá', question:'Czy ≈õledzisz obcojƒôzyczne media?', options:[
    {text:'Nie', points:5},
    {text:'Czasem', points:6},
    {text:'Dobrze', points:8},
    {text:'Perfekcyjnie', points:10}
  ]},
  {category:'Jƒôzykowo≈õƒá', question:'Czy znasz idiomy i slang?', options:[
    {text:'Nie', points:5},
    {text:'Trochƒô', points:6},
    {text:'Dobrze', points:8},
    {text:'Perfekcyjnie', points:10}
  ]},

  // --------------------
  // 7. IQ - 10 pyta≈Ñ
  {category:'IQ', question:'Jaki jest Tw√≥j wynik IQ?', options:[
    {text:'<100', points:1},
    {text:'~100', points:3},
    {text:'>120', points:4},
    {text:'>150', points:5}
  ]},
  {category:'IQ', question:'Czy szybko rozwiƒÖzujesz zadania logiczne?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:3},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
  {category:'IQ', question:'Czy analizujesz skomplikowane problemy?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:3},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
  {category:'IQ', question:'Czy potrafisz abstrakcyjnie my≈õleƒá?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:3},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
  {category:'IQ', question:'Czy radzisz sobie z ≈Çamig≈Ç√≥wkami?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:3},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
  {category:'IQ', question:'Czy szybko uczysz siƒô nowych umiejƒôtno≈õci?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:3},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
  {category:'IQ', question:'Czy rozumiesz z≈Ço≈ºone koncepcje?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:3},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
  {category:'IQ', question:'Czy potrafisz my≈õleƒá strategicznie?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:3},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
  {category:'IQ', question:'Czy analizujesz ryzyko przed decyzjƒÖ?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:3},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
  {category:'IQ', question:'Czy rozwiƒÖzujesz problemy matematyczne ≈Çatwo?', options:[
    {text:'Nie', points:1},
    {text:'Czasem', points:3},
    {text:'Dobrze', points:4},
    {text:'Perfekcyjnie', points:5}
  ]},
];

let currentQuestion = 0;
let results = {};
let counts = {};

function showQuestion(){
  const q = quizData[currentQuestion];
  document.getElementById('question-text').textContent = q.question;
  const optionsContainer = document.getElementById('options-container');
  optionsContainer.innerHTML = '';
  q.options.forEach(opt=>{
    const btn = document.createElement('button');
    btn.textContent = opt.text;
    btn.onclick = ()=>selectOption(opt.points, q.category);
    optionsContainer.appendChild(btn);
  });
}

function selectOption(points, category){
  if(!results[category]) results[category]=0;
  if(!counts[category]) counts[category]=0;
  results[category]+=points;
  counts[category]+=1;
  currentQuestion++;
  if(currentQuestion<quizData.length){
    showQuestion();
  }else{
    showResults();
  }
}

function showResults(){
  document.getElementById('quiz-container').style.display='none';
  document.getElementById('results').style.display='block';

  const avgResults = {};
  let sum = 0, n = 0;
  for(let cat in results){
    avgResults[cat] = results[cat]/counts[cat];
    sum += avgResults[cat];
    n++;
  }
  const overall = sum/n;

  const ctx = document.getElementById('resultsChart').getContext('2d');
  new Chart(ctx,{
    type:'bar',
    data:{
      labels: Object.keys(avgResults),
      datasets:[{
        label:'≈öredni wynik w kategorii',
        data: Object.values(avgResults),
        backgroundColor:'rgba(54, 162, 235, 0.6)',
        borderColor:'rgba(54, 162, 235, 1)',
        borderWidth:1
      }]
    },
    options:{ scales:{ y:{beginAtZero:true,max:10} } }
  });

  // Overall opis
  let overallDesc='';
  if(overall<=3.0) overallDesc='Cz≈Çowiek';
  else if(overall<=5.0) overallDesc='Przeciƒôtny wynik';
  else if(overall<=6.0) overallDesc='Ponad przeciƒôtny wynik';
  else if(overall<=7.5) overallDesc='Dobry wynik';
  else if(overall<=8.5) overallDesc='Wysokie kwalifikacje';
  else if(overall<=9.9) overallDesc='Nad-cz≈Çowiek';
  else overallDesc='Perfekcjonista!';

  document.getElementById('overallDesc').textContent = `Tw√≥j wynik overall: ${overall.toFixed(2)} ‚Üí ${overallDesc}`;
}

// start quiz
showQuestion();
</script>
</body>
</html>





